import { __decorate, __extends, __metadata, __read, __rest, __spread } from "tslib";
import { Component, ElementRef, forwardRef, Renderer2, ViewChild, AfterViewInit } from '@angular/core';
import { NG_VALIDATORS, NG_VALUE_ACCESSOR } from '@angular/forms';
import { formatBytes, isMobile } from '../../../utils/util';
import { PoButtonComponent } from './../../po-button/po-button.component';
import { PoI18nPipe } from '../../../services/po-i18n/po-i18n.pipe';
import { PoNotificationService } from '../../../services/po-notification/po-notification.service';
import { PoProgressStatus } from '../../po-progress/enums/po-progress-status.enum';
import { PoLanguageService } from '../../../services/po-language/po-language.service';
import { PoUploadBaseComponent } from './po-upload-base.component';
import { PoUploadDragDropComponent } from './po-upload-drag-drop/po-upload-drag-drop.component';
import { PoUploadService } from './po-upload.service';
import { PoUploadStatus } from './po-upload-status.enum';
/**
 * @docsExtends PoUploadBaseComponent
 *
 * @example
 *
 * <example name="po-upload-basic" title="PO Upload Basic">
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.html"> </file>
 *   <file name="sample-po-upload-basic/sample-po-upload-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-labs" title="PO Upload Labs">
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.html"> </file>
 *   <file name="sample-po-upload-labs/sample-po-upload-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-resume" title="PO Upload - Resume">
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.html"> </file>
 *   <file name="sample-po-upload-resume/sample-po-upload-resume.component.ts"> </file>
 * </example>
 *
 * <example name="po-upload-rs" title="PO Upload - Realize & Show">
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.html"> </file>
 *   <file name="sample-po-upload-rs/sample-po-upload-rs.component.ts"> </file>
 * </example>
 */
var PoUploadComponent = /** @class */ (function (_super) {
    __extends(PoUploadComponent, _super);
    function PoUploadComponent(uploadService, renderer, i18nPipe, notification, languageService) {
        var _a, _b;
        var _this = _super.call(this, uploadService, languageService) || this;
        _this.renderer = renderer;
        _this.i18nPipe = i18nPipe;
        _this.notification = notification;
        _this.infoByUploadStatus = (_a = {},
            _a[PoUploadStatus.Uploaded] = {
                text: function () { return _this.literals.sentWithSuccess; },
                icon: 'po-icon-ok'
            },
            _a[PoUploadStatus.Error] = {
                text: function () { return _this.literals.errorOccurred; }
            },
            _a[PoUploadStatus.Uploading] = {
                text: function (percent) { return percent + '%'; }
            },
            _a);
        _this.progressStatusByFileStatus = (_b = {},
            _b[PoUploadStatus.Uploaded] = PoProgressStatus.Success,
            _b[PoUploadStatus.Error] = PoProgressStatus.Error,
            _b);
        _this.calledByCleanInputValue = false;
        return _this;
    }
    PoUploadComponent_1 = PoUploadComponent;
    Object.defineProperty(PoUploadComponent.prototype, "displayDragDrop", {
        get: function () {
            return this.dragDrop && !isMobile();
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "displaySendButton", {
        get: function () {
            var currentFiles = this.currentFiles || [];
            return !this.hideSendButton && !this.autoUpload && currentFiles.length > 0 && this.hasFileNotUploaded;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "selectFileButtonLabel", {
        get: function () {
            if (this.canHandleDirectory) {
                return this.literals.selectFolder;
            }
            else if (this.isMultiple) {
                return this.literals.selectFiles;
            }
            else {
                return this.literals.selectFile;
            }
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "hasMoreThanFourItems", {
        get: function () {
            return this.currentFiles && this.currentFiles.length > 4;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "hasMultipleFiles", {
        get: function () {
            return this.currentFiles && this.currentFiles.length > 1;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "hasFileNotUploaded", {
        get: function () {
            if (Array.isArray(this.currentFiles)) {
                return this.currentFiles.some(function (file) { return file.status !== PoUploadStatus.Uploaded; });
            }
            return false;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "isDisabled", {
        get: function () {
            var currentFiles = this.currentFiles || [];
            return !!(this.hasAnyFileUploading(currentFiles) ||
                !this.url ||
                this.disabled ||
                this.isExceededFileLimit(currentFiles.length));
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoUploadComponent.prototype, "maxFiles", {
        get: function () {
            return this.isMultiple && this.fileRestrictions && this.fileRestrictions.maxFiles;
        },
        enumerable: true,
        configurable: true
    });
    PoUploadComponent.prototype.cancel = function (file) {
        if (file.status === PoUploadStatus.Uploading) {
            return this.stopUpload(file);
        }
        this.removeFile(file);
    };
    PoUploadComponent.prototype.ngAfterViewInit = function () {
        if (this.autoFocus) {
            this.focus();
        }
    };
    /** Método responsável por **limpar** o(s) arquivo(s) selecionado(s). */
    PoUploadComponent.prototype.clear = function () {
        this.currentFiles = undefined;
        this.updateModel([]);
        this.cleanInputValue();
    };
    /**
     * Função que atribui foco ao componente.
     *
     * Para utilizá-la é necessário ter a instância do componente no DOM, podendo ser utilizado o ViewChild da seguinte forma:
     *
     * ```
     * import { PoUploadComponent } from '@po-ui/ng-components';
     *
     * ...
     *
     * @ViewChild(PoUploadComponent, { static: true }) upload: PoUploadComponent;
     *
     * focusUpload() {
     *   this.upload.focus();
     * }
     * ```
     */
    PoUploadComponent.prototype.focus = function () {
        if (!this.disabled) {
            if (this.uploadButton) {
                this.uploadButton.focus();
                return;
            }
            if (this.displayDragDrop) {
                this.poUploadDragDropComponent.focus();
            }
        }
    };
    // Verifica se existe algum arquivo sendo enviado ao serviço.
    PoUploadComponent.prototype.hasAnyFileUploading = function (files) {
        if (files && files.length) {
            return files.some(function (file) { return file.status === PoUploadStatus.Uploading; });
        }
        return false;
    };
    // retorna se o status do arquivo é diferente de enviado
    PoUploadComponent.prototype.isAllowCancelEvent = function (status) {
        return status !== PoUploadStatus.Uploaded;
    };
    // Função disparada ao selecionar algum arquivo.
    PoUploadComponent.prototype.onFileChange = function (event) {
        // necessário este tratamento quando para IE, pois nele o change é disparado quando o campo é limpado também
        if (this.calledByCleanInputValue) {
            this.calledByCleanInputValue = false;
            return event.preventDefault();
        }
        var files = event.target.files;
        this.updateFiles(files);
        this.cleanInputValue();
    };
    PoUploadComponent.prototype.onFileChangeDragDrop = function (files) {
        this.updateFiles(files);
    };
    // Remove o arquivo passado por parâmetro da lista dos arquivos correntes.
    PoUploadComponent.prototype.removeFile = function (file) {
        var index = this.currentFiles.indexOf(file);
        this.currentFiles.splice(index, 1);
        this.updateModel(__spread(this.currentFiles));
    };
    /** Método responsável por **abrir** a janela para seleção de arquivo(s). */
    PoUploadComponent.prototype.selectFiles = function () {
        this.calledByCleanInputValue = false;
        this.inputFile.nativeElement.click();
    };
    PoUploadComponent.prototype.sendFeedback = function () {
        if (this.sizeNotAllowed > 0) {
            var minFileSize = formatBytes(this.fileRestrictions.minFileSize);
            var maxFileSize = formatBytes(this.fileRestrictions.maxFileSize);
            var args = [this.sizeNotAllowed, minFileSize || '0', maxFileSize];
            this.setPipeArguments('invalidSize', args);
            this.sizeNotAllowed = 0;
        }
        if (this.extensionNotAllowed > 0) {
            var allowedExtensionsFormatted = this.fileRestrictions.allowedExtensions.join(', ').toUpperCase();
            var args = [this.extensionNotAllowed, allowedExtensionsFormatted];
            this.setPipeArguments('invalidFormat', args);
            this.extensionNotAllowed = 0;
        }
        if (this.quantityNotAllowed > 0) {
            var args = [this.quantityNotAllowed];
            this.setPipeArguments('invalidAmount', args);
            this.quantityNotAllowed = 0;
        }
    };
    /** Método responsável por **enviar** o(s) arquivo(s) selecionado(s). */
    PoUploadComponent.prototype.sendFiles = function () {
        if (this.currentFiles && this.currentFiles.length) {
            this.uploadFiles(this.currentFiles);
        }
    };
    PoUploadComponent.prototype.setDirectoryAttribute = function (canHandleDirectory) {
        if (canHandleDirectory) {
            this.renderer.setAttribute(this.inputFile.nativeElement, 'webkitdirectory', 'true');
        }
        else {
            this.renderer.removeAttribute(this.inputFile.nativeElement, 'webkitdirectory');
        }
    };
    // Caso o componente estiver no modo AutoUpload, o arquivo também será removido da lista.
    PoUploadComponent.prototype.stopUpload = function (file) {
        var _this = this;
        this.uploadService.stopRequestByFile(file, function () {
            if (_this.autoUpload) {
                _this.removeFile(file);
            }
            else {
                _this.stopUploadHandler(file);
            }
        });
    };
    PoUploadComponent.prototype.trackByFn = function (index, file) {
        return file.uid;
    };
    // Envia os arquivos passados por parâmetro, exceto os que já foram enviados ao serviço.
    PoUploadComponent.prototype.uploadFiles = function (files) {
        var _this = this;
        var filesFiltered = files.filter(function (file) { return file.status !== PoUploadStatus.Uploaded; });
        this.uploadService.upload(this.url, filesFiltered, this.onUpload, function (file, percent) {
            // UPLOADING
            _this.uploadingHandler(file, percent);
        }, function (file, eventResponse) {
            // SUCCESS
            _this.responseHandler(file, PoUploadStatus.Uploaded);
            _this.onSuccess.emit(eventResponse);
        }, function (file, eventError) {
            // Error
            _this.responseHandler(file, PoUploadStatus.Error);
            _this.onError.emit(eventError);
        });
    };
    PoUploadComponent.prototype.cleanInputValue = function () {
        this.calledByCleanInputValue = true;
        this.inputFile.nativeElement.value = '';
    };
    // função disparada na resposta do sucesso ou error
    PoUploadComponent.prototype.responseHandler = function (file, status) {
        file.status = status;
        file.percent = 100;
    };
    // método responsável por setar os argumentos do i18nPipe de acordo com a restrição.
    PoUploadComponent.prototype.setPipeArguments = function (literalAttributes, literalArguments) {
        var pipeArguments = this.i18nPipe.transform(this.literals[literalAttributes], literalArguments);
        this.notification.information(pipeArguments);
    };
    // Função disparada ao parar um envio de arquivo.
    PoUploadComponent.prototype.stopUploadHandler = function (file) {
        file.status = PoUploadStatus.None;
        file.percent = 0;
    };
    PoUploadComponent.prototype.updateFiles = function (files) {
        this.currentFiles = this.parseFiles(files);
        this.updateModel(__spread(this.currentFiles));
        if (this.autoUpload) {
            this.uploadFiles(this.currentFiles);
        }
    };
    // Atualiza o ngModel para os arquivos passados por parâmetro.
    PoUploadComponent.prototype.updateModel = function (files) {
        var modelFiles = this.mapCleanUploadFiles(files);
        this.onModelChange ? this.onModelChange(modelFiles) : this.ngModelChange.emit(modelFiles);
    };
    // Função disparada enquanto o arquivo está sendo enviado ao serviço.
    PoUploadComponent.prototype.uploadingHandler = function (file, percent) {
        file.status = PoUploadStatus.Uploading;
        file.percent = percent;
    };
    // retorna os objetos do array sem as propriedades: percent e displayName
    PoUploadComponent.prototype.mapCleanUploadFiles = function (files) {
        var mapedByUploadFile = function (progressFile) {
            var percent = progressFile.percent, displayName = progressFile.displayName, uploadFile = __rest(progressFile, ["percent", "displayName"]);
            return uploadFile;
        };
        return files.map(mapedByUploadFile);
    };
    var PoUploadComponent_1;
    PoUploadComponent.ctorParameters = function () { return [
        { type: PoUploadService },
        { type: Renderer2 },
        { type: PoI18nPipe },
        { type: PoNotificationService },
        { type: PoLanguageService }
    ]; };
    __decorate([
        ViewChild('inputFile', { read: ElementRef, static: true }),
        __metadata("design:type", ElementRef)
    ], PoUploadComponent.prototype, "inputFile", void 0);
    __decorate([
        ViewChild(PoUploadDragDropComponent),
        __metadata("design:type", PoUploadDragDropComponent)
    ], PoUploadComponent.prototype, "poUploadDragDropComponent", void 0);
    __decorate([
        ViewChild('uploadButton'),
        __metadata("design:type", PoButtonComponent)
    ], PoUploadComponent.prototype, "uploadButton", void 0);
    PoUploadComponent = PoUploadComponent_1 = __decorate([
        Component({
            selector: 'po-upload',
            template: "<po-field-container [p-label]=\"label\" [p-help]=\"help\" [p-optional]=\"!required && optional\">\n  <div class=\"po-upload\">\n    <input\n      #inputFile\n      class=\"po-upload-input\"\n      type=\"file\"\n      [accept]=\"allowedExtensions\"\n      [attr.name]=\"name\"\n      [disabled]=\"isDisabled\"\n      [multiple]=\"isMultiple\"\n      [required]=\"required\"\n      (change)=\"onFileChange($event)\"\n    />\n\n    <po-upload-drag-drop\n      *ngIf=\"displayDragDrop\"\n      [p-directory-compatible]=\"canHandleDirectory\"\n      [p-disabled]=\"isDisabled\"\n      [p-drag-drop-height]=\"dragDropHeight\"\n      [p-literals]=\"literals\"\n      (p-file-change)=\"onFileChangeDragDrop($event)\"\n      (p-select-files)=\"selectFiles()\"\n    >\n    </po-upload-drag-drop>\n\n    <po-button\n      *ngIf=\"!hideSelectButton && !displayDragDrop\"\n      #uploadButton\n      class=\"po-upload-button\"\n      for=\"file\"\n      [p-disabled]=\"isDisabled\"\n      [p-label]=\"selectFileButtonLabel\"\n      (p-click)=\"selectFiles()\"\n    >\n    </po-button>\n\n    <po-upload-file-restrictions\n      *ngIf=\"fileRestrictions && !hideRestrictionsInfo\"\n      class=\"po-upload-file-restrictions\"\n      [ngClass]=\"{ 'po-upload-file-restrictions-drag-drop': displayDragDrop }\"\n      [p-allowed-extensions]=\"fileRestrictions?.allowedExtensions\"\n      [p-max-files]=\"maxFiles\"\n      [p-max-file-size]=\"fileRestrictions?.maxFileSize\"\n      [p-min-file-size]=\"fileRestrictions?.minFileSize\"\n    >\n    </po-upload-file-restrictions>\n\n    <div *ngIf=\"currentFiles && currentFiles.length\" class=\"po-upload-progress-container\">\n      <po-container\n        p-no-shadow\n        [p-height]=\"hasMoreThanFourItems ? 280 : 'auto'\"\n        [p-no-border]=\"!hasMoreThanFourItems\"\n        [p-no-padding]=\"!hasMoreThanFourItems\"\n      >\n        <div [ngClass]=\"{ 'po-upload-progress-container-area po-pt-2 po-pl-1': hasMoreThanFourItems }\">\n          <po-progress\n            *ngFor=\"let file of currentFiles; trackBy: trackByFn\"\n            [p-info]=\"infoByUploadStatus[file.status]?.text(file.percent)\"\n            [p-info-icon]=\"infoByUploadStatus[file.status]?.icon\"\n            [p-status]=\"progressStatusByFileStatus[file.status]\"\n            [p-text]=\"file.displayName\"\n            [p-value]=\"file.percent\"\n            (p-cancel)=\"cancel(file)\"\n            (p-retry)=\"uploadFiles([file])\"\n          >\n          </po-progress>\n        </div>\n      </po-container>\n    </div>\n\n    <po-button\n      *ngIf=\"displaySendButton\"\n      class=\"po-upload-send-button\"\n      [class.po-mt-3]=\"hasMoreThanFourItems\"\n      p-type=\"primary\"\n      [p-disabled]=\"hasAnyFileUploading(currentFiles)\"\n      [p-label]=\"literals.startSending\"\n      (p-click)=\"uploadFiles(currentFiles)\"\n    >\n    </po-button>\n  </div>\n</po-field-container>\n",
            providers: [
                PoI18nPipe,
                PoUploadService,
                {
                    provide: NG_VALUE_ACCESSOR,
                    useExisting: forwardRef(function () { return PoUploadComponent_1; }),
                    multi: true
                },
                {
                    provide: NG_VALIDATORS,
                    useExisting: forwardRef(function () { return PoUploadComponent_1; }),
                    multi: true
                }
            ]
        }),
        __metadata("design:paramtypes", [PoUploadService,
            Renderer2,
            PoI18nPipe,
            PoNotificationService,
            PoLanguageService])
    ], PoUploadComponent);
    return PoUploadComponent;
}(PoUploadBaseComponent));
export { PoUploadComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tdXBsb2FkLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwby11aS9uZy1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZmllbGQvcG8tdXBsb2FkL3BvLXVwbG9hZC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLGFBQWEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUN2RyxPQUFPLEVBQUUsYUFBYSxFQUFFLGlCQUFpQixFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFFbEUsT0FBTyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSx1Q0FBdUMsQ0FBQztBQUMxRSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sd0NBQXdDLENBQUM7QUFDcEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMkRBQTJELENBQUM7QUFDbEcsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0saURBQWlELENBQUM7QUFDbkYsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sbURBQW1ELENBQUM7QUFFdEYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDbkUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLE1BQU0scURBQXFELENBQUM7QUFFaEcsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3RELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUV6RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBd0JHO0FBbUJIO0lBQXVDLHFDQUFxQjtJQXlCMUQsMkJBQ0UsYUFBOEIsRUFDdkIsUUFBbUIsRUFDbEIsUUFBb0IsRUFDcEIsWUFBbUMsRUFDM0MsZUFBa0M7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QWlCLENBQUM7b0JBQ2hELEtBQUssRUFBRSxJQUFJO2lCQUNaO2FBQ0Y7U0FDRixDQUFDO3lDQTJCaUIsZUFBZTtZQUNiLFNBQVM7WUFDUixVQUFVO1lBQ04scUJBQXFCO1lBQzFCLGlCQUFpQjtPQTlCekIsaUJBQWlCLENBMlQ3QjtJQUFELHdCQUFDO0NBQUEsQUEzVEQsQ0FBdUMscUJBQXFCLEdBMlQzRDtTQTNUWSxpQkFBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIGZvcndhcmRSZWYsIFJlbmRlcmVyMiwgVmlld0NoaWxkLCBBZnRlclZpZXdJbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOR19WQUxJREFUT1JTLCBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcblxuaW1wb3J0IHsgZm9ybWF0Qnl0ZXMsIGlzTW9iaWxlIH0gZnJvbSAnLi4vLi4vLi4vdXRpbHMvdXRpbCc7XG5pbXBvcnQgeyBQb0J1dHRvbkNvbXBvbmVudCB9IGZyb20gJy4vLi4vLi4vcG8tYnV0dG9uL3BvLWJ1dHRvbi5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9JMThuUGlwZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLWkxOG4vcG8taTE4bi5waXBlJztcbmltcG9ydCB7IFBvTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJy4uLy4uLy4uL3NlcnZpY2VzL3BvLW5vdGlmaWNhdGlvbi9wby1ub3RpZmljYXRpb24uc2VydmljZSc7XG5pbXBvcnQgeyBQb1Byb2dyZXNzU3RhdHVzIH0gZnJvbSAnLi4vLi4vcG8tcHJvZ3Jlc3MvZW51bXMvcG8tcHJvZ3Jlc3Mtc3RhdHVzLmVudW0nO1xuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi8uLi9zZXJ2aWNlcy9wby1sYW5ndWFnZS9wby1sYW5ndWFnZS5zZXJ2aWNlJztcblxuaW1wb3J0IHsgUG9VcGxvYWRCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby11cGxvYWQtYmFzZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgUG9VcGxvYWREcmFnRHJvcENvbXBvbmVudCB9IGZyb20gJy4vcG8tdXBsb2FkLWRyYWctZHJvcC9wby11cGxvYWQtZHJhZy1kcm9wLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb1VwbG9hZEZpbGUgfSBmcm9tICcuL3BvLXVwbG9hZC1maWxlJztcbmltcG9ydCB7IFBvVXBsb2FkU2VydmljZSB9IGZyb20gJy4vcG8tdXBsb2FkLnNlcnZpY2UnO1xuaW1wb3J0IHsgUG9VcGxvYWRTdGF0dXMgfSBmcm9tICcuL3BvLXVwbG9hZC1zdGF0dXMuZW51bSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvVXBsb2FkQmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1iYXNpY1wiIHRpdGxlPVwiUE8gVXBsb2FkIEJhc2ljXCI+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLWJhc2ljL3NhbXBsZS1wby11cGxvYWQtYmFzaWMuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1iYXNpYy9zYW1wbGUtcG8tdXBsb2FkLWJhc2ljLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1sYWJzXCIgdGl0bGU9XCJQTyBVcGxvYWQgTGFic1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1sYWJzL3NhbXBsZS1wby11cGxvYWQtbGFicy5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tdXBsb2FkLWxhYnMvc2FtcGxlLXBvLXVwbG9hZC1sYWJzLmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLXVwbG9hZC1yZXN1bWVcIiB0aXRsZT1cIlBPIFVwbG9hZCAtIFJlc3VtZVwiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUvc2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUuY29tcG9uZW50Lmh0bWxcIj4gPC9maWxlPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUvc2FtcGxlLXBvLXVwbG9hZC1yZXN1bWUuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tdXBsb2FkLXJzXCIgdGl0bGU9XCJQTyBVcGxvYWQgLSBSZWFsaXplICYgU2hvd1wiPlxuICogICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLXVwbG9hZC1ycy9zYW1wbGUtcG8tdXBsb2FkLXJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby11cGxvYWQtcnMvc2FtcGxlLXBvLXVwbG9hZC1ycy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwby11cGxvYWQnLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tdXBsb2FkLmNvbXBvbmVudC5odG1sJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAgUG9JMThuUGlwZSxcbiAgICBQb1VwbG9hZFNlcnZpY2UsXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBQb1VwbG9hZENvbXBvbmVudCksXG4gICAgICBtdWx0aTogdHJ1ZVxuICAgIH0sXG4gICAge1xuICAgICAgcHJvdmlkZTogTkdfVkFMSURBVE9SUyxcbiAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IFBvVXBsb2FkQ29tcG9uZW50KSxcbiAgICAgIG11bHRpOiB0cnVlXG4gICAgfVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIFBvVXBsb2FkQ29tcG9uZW50IGV4dGVuZHMgUG9VcGxvYWRCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG4gIGluZm9CeVVwbG9hZFN0YXR1czogeyBba2V5OiBzdHJpbmddOiB7IHRleHQ6IChwZXJjZW50PzogbnVtYmVyKSA9PiBzdHJpbmc7IGljb24/OiBzdHJpbmcgfSB9ID0ge1xuICAgIFtQb1VwbG9hZFN0YXR1cy5VcGxvYWRlZF06IHtcbiAgICAgIHRleHQ6ICgpID0+IHRoaXMubGl0ZXJhbHMuc2VudFdpdGhTdWNjZXNzLFxuICAgICAgaWNvbjogJ3BvLWljb24tb2snXG4gICAgfSxcbiAgICBbUG9VcGxvYWRTdGF0dXMuRXJyb3JdOiB7XG4gICAgICB0ZXh0OiAoKSA9PiB0aGlzLmxpdGVyYWxzLmVycm9yT2NjdXJyZWRcbiAgICB9LFxuICAgIFtQb1VwbG9hZFN0YXR1cy5VcGxvYWRpbmddOiB7XG4gICAgICB0ZXh0OiBwZXJjZW50ID0+IHBlcmNlbnQgKyAnJSdcbiAgICB9XG4gIH07XG5cbiAgcHJvZ3Jlc3NTdGF0dXNCeUZpbGVTdGF0dXMgPSB7XG4gICAgW1BvVXBsb2FkU3RhdHVzLlVwbG9hZGVkXTogUG9Qcm9ncmVzc1N0YXR1cy5TdWNjZXNzLFxuICAgIFtQb1VwbG9hZFN0YXR1cy5FcnJvcl06IFBvUHJvZ3Jlc3NTdGF0dXMuRXJyb3JcbiAgfTtcblxuICBwcml2YXRlIGNhbGxlZEJ5Q2xlYW5JbnB1dFZhbHVlOiBib29sZWFuID0gZmFsc2U7XG5cbiAgQFZpZXdDaGlsZCgnaW5wdXRGaWxlJywgeyByZWFkOiBFbGVtZW50UmVmLCBzdGF0aWM6IHRydWUgfSkgcHJpdmF0ZSBpbnB1dEZpbGU6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoUG9VcGxvYWREcmFnRHJvcENvbXBvbmVudCkgcHJpdmF0ZSBwb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50OiBQb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50O1xuICBAVmlld0NoaWxkKCd1cGxvYWRCdXR0b24nKSBwcml2YXRlIHVwbG9hZEJ1dHRvbjogUG9CdXR0b25Db21wb25lbnQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgdXBsb2FkU2VydmljZTogUG9VcGxvYWRTZXJ2aWNlLFxuICAgIHB1YmxpYyByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgaTE4blBpcGU6IFBvSTE4blBpcGUsXG4gICAgcHJpdmF0ZSBub3RpZmljYXRpb246IFBvTm90aWZpY2F0aW9uU2VydmljZSxcbiAgICBsYW5ndWFnZVNlcnZpY2U6IFBvTGFuZ3VhZ2VTZXJ2aWNlXG4gICkge1xuICAgIHN1cGVyKHVwbG9hZFNlcnZpY2UsIGxhbmd1YWdlU2VydmljZSk7XG4gIH1cblxuICBnZXQgZGlzcGxheURyYWdEcm9wKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmRyYWdEcm9wICYmICFpc01vYmlsZSgpO1xuICB9XG5cbiAgZ2V0IGRpc3BsYXlTZW5kQnV0dG9uKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGN1cnJlbnRGaWxlcyA9IHRoaXMuY3VycmVudEZpbGVzIHx8IFtdO1xuICAgIHJldHVybiAhdGhpcy5oaWRlU2VuZEJ1dHRvbiAmJiAhdGhpcy5hdXRvVXBsb2FkICYmIGN1cnJlbnRGaWxlcy5sZW5ndGggPiAwICYmIHRoaXMuaGFzRmlsZU5vdFVwbG9hZGVkO1xuICB9XG5cbiAgZ2V0IHNlbGVjdEZpbGVCdXR0b25MYWJlbCgpIHtcbiAgICBpZiAodGhpcy5jYW5IYW5kbGVEaXJlY3RvcnkpIHtcbiAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnNlbGVjdEZvbGRlcjtcbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNdWx0aXBsZSkge1xuICAgICAgcmV0dXJuIHRoaXMubGl0ZXJhbHMuc2VsZWN0RmlsZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmxpdGVyYWxzLnNlbGVjdEZpbGU7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGhhc01vcmVUaGFuRm91ckl0ZW1zKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRGaWxlcyAmJiB0aGlzLmN1cnJlbnRGaWxlcy5sZW5ndGggPiA0O1xuICB9XG5cbiAgZ2V0IGhhc011bHRpcGxlRmlsZXMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGVzICYmIHRoaXMuY3VycmVudEZpbGVzLmxlbmd0aCA+IDE7XG4gIH1cblxuICBnZXQgaGFzRmlsZU5vdFVwbG9hZGVkKCk6IGJvb2xlYW4ge1xuICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMuY3VycmVudEZpbGVzKSkge1xuICAgICAgcmV0dXJuIHRoaXMuY3VycmVudEZpbGVzLnNvbWUoZmlsZSA9PiBmaWxlLnN0YXR1cyAhPT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkZWQpO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGdldCBpc0Rpc2FibGVkKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGN1cnJlbnRGaWxlcyA9IHRoaXMuY3VycmVudEZpbGVzIHx8IFtdO1xuXG4gICAgcmV0dXJuICEhKFxuICAgICAgdGhpcy5oYXNBbnlGaWxlVXBsb2FkaW5nKGN1cnJlbnRGaWxlcykgfHxcbiAgICAgICF0aGlzLnVybCB8fFxuICAgICAgdGhpcy5kaXNhYmxlZCB8fFxuICAgICAgdGhpcy5pc0V4Y2VlZGVkRmlsZUxpbWl0KGN1cnJlbnRGaWxlcy5sZW5ndGgpXG4gICAgKTtcbiAgfVxuXG4gIGdldCBtYXhGaWxlcygpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmlzTXVsdGlwbGUgJiYgdGhpcy5maWxlUmVzdHJpY3Rpb25zICYmIHRoaXMuZmlsZVJlc3RyaWN0aW9ucy5tYXhGaWxlcztcbiAgfVxuXG4gIGNhbmNlbChmaWxlOiBQb1VwbG9hZEZpbGUpIHtcbiAgICBpZiAoZmlsZS5zdGF0dXMgPT09IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGluZykge1xuICAgICAgcmV0dXJuIHRoaXMuc3RvcFVwbG9hZChmaWxlKTtcbiAgICB9XG5cbiAgICB0aGlzLnJlbW92ZUZpbGUoZmlsZSk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKSB7XG4gICAgaWYgKHRoaXMuYXV0b0ZvY3VzKSB7XG4gICAgICB0aGlzLmZvY3VzKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIE3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciAqKmxpbXBhcioqIG8ocykgYXJxdWl2byhzKSBzZWxlY2lvbmFkbyhzKS4gKi9cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5jdXJyZW50RmlsZXMgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy51cGRhdGVNb2RlbChbXSk7XG4gICAgdGhpcy5jbGVhbklucHV0VmFsdWUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGdW7Dp8OjbyBxdWUgYXRyaWJ1aSBmb2NvIGFvIGNvbXBvbmVudGUuXG4gICAqXG4gICAqIFBhcmEgdXRpbGl6w6EtbGEgw6kgbmVjZXNzw6FyaW8gdGVyIGEgaW5zdMOibmNpYSBkbyBjb21wb25lbnRlIG5vIERPTSwgcG9kZW5kbyBzZXIgdXRpbGl6YWRvIG8gVmlld0NoaWxkIGRhIHNlZ3VpbnRlIGZvcm1hOlxuICAgKlxuICAgKiBgYGBcbiAgICogaW1wb3J0IHsgUG9VcGxvYWRDb21wb25lbnQgfSBmcm9tICdAcG8tdWkvbmctY29tcG9uZW50cyc7XG4gICAqXG4gICAqIC4uLlxuICAgKlxuICAgKiBAVmlld0NoaWxkKFBvVXBsb2FkQ29tcG9uZW50LCB7IHN0YXRpYzogdHJ1ZSB9KSB1cGxvYWQ6IFBvVXBsb2FkQ29tcG9uZW50O1xuICAgKlxuICAgKiBmb2N1c1VwbG9hZCgpIHtcbiAgICogICB0aGlzLnVwbG9hZC5mb2N1cygpO1xuICAgKiB9XG4gICAqIGBgYFxuICAgKi9cbiAgZm9jdXMoKSB7XG4gICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XG4gICAgICBpZiAodGhpcy51cGxvYWRCdXR0b24pIHtcbiAgICAgICAgdGhpcy51cGxvYWRCdXR0b24uZm9jdXMoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5kaXNwbGF5RHJhZ0Ryb3ApIHtcbiAgICAgICAgdGhpcy5wb1VwbG9hZERyYWdEcm9wQ29tcG9uZW50LmZvY3VzKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gVmVyaWZpY2Egc2UgZXhpc3RlIGFsZ3VtIGFycXVpdm8gc2VuZG8gZW52aWFkbyBhbyBzZXJ2acOnby5cbiAgaGFzQW55RmlsZVVwbG9hZGluZyhmaWxlczogQXJyYXk8UG9VcGxvYWRGaWxlPikge1xuICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBmaWxlcy5zb21lKGZpbGUgPT4gZmlsZS5zdGF0dXMgPT09IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGluZyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gcmV0b3JuYSBzZSBvIHN0YXR1cyBkbyBhcnF1aXZvIMOpIGRpZmVyZW50ZSBkZSBlbnZpYWRvXG4gIGlzQWxsb3dDYW5jZWxFdmVudChzdGF0dXM6IFBvVXBsb2FkU3RhdHVzKSB7XG4gICAgcmV0dXJuIHN0YXR1cyAhPT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkZWQ7XG4gIH1cblxuICAvLyBGdW7Dp8OjbyBkaXNwYXJhZGEgYW8gc2VsZWNpb25hciBhbGd1bSBhcnF1aXZvLlxuICBvbkZpbGVDaGFuZ2UoZXZlbnQpOiB2b2lkIHtcbiAgICAvLyBuZWNlc3PDoXJpbyBlc3RlIHRyYXRhbWVudG8gcXVhbmRvIHBhcmEgSUUsIHBvaXMgbmVsZSBvIGNoYW5nZSDDqSBkaXNwYXJhZG8gcXVhbmRvIG8gY2FtcG8gw6kgbGltcGFkbyB0YW1iw6ltXG4gICAgaWYgKHRoaXMuY2FsbGVkQnlDbGVhbklucHV0VmFsdWUpIHtcbiAgICAgIHRoaXMuY2FsbGVkQnlDbGVhbklucHV0VmFsdWUgPSBmYWxzZTtcbiAgICAgIHJldHVybiBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cblxuICAgIGNvbnN0IGZpbGVzID0gZXZlbnQudGFyZ2V0LmZpbGVzO1xuICAgIHRoaXMudXBkYXRlRmlsZXMoZmlsZXMpO1xuXG4gICAgdGhpcy5jbGVhbklucHV0VmFsdWUoKTtcbiAgfVxuXG4gIG9uRmlsZUNoYW5nZURyYWdEcm9wKGZpbGVzKSB7XG4gICAgdGhpcy51cGRhdGVGaWxlcyhmaWxlcyk7XG4gIH1cblxuICAvLyBSZW1vdmUgbyBhcnF1aXZvIHBhc3NhZG8gcG9yIHBhcsOibWV0cm8gZGEgbGlzdGEgZG9zIGFycXVpdm9zIGNvcnJlbnRlcy5cbiAgcmVtb3ZlRmlsZShmaWxlKTogdm9pZCB7XG4gICAgY29uc3QgaW5kZXggPSB0aGlzLmN1cnJlbnRGaWxlcy5pbmRleE9mKGZpbGUpO1xuICAgIHRoaXMuY3VycmVudEZpbGVzLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICB0aGlzLnVwZGF0ZU1vZGVsKFsuLi50aGlzLmN1cnJlbnRGaWxlc10pO1xuICB9XG5cbiAgLyoqIE3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciAqKmFicmlyKiogYSBqYW5lbGEgcGFyYSBzZWxlw6fDo28gZGUgYXJxdWl2byhzKS4gKi9cbiAgc2VsZWN0RmlsZXMoKSB7XG4gICAgdGhpcy5jYWxsZWRCeUNsZWFuSW5wdXRWYWx1ZSA9IGZhbHNlO1xuICAgIHRoaXMuaW5wdXRGaWxlLm5hdGl2ZUVsZW1lbnQuY2xpY2soKTtcbiAgfVxuXG4gIHNlbmRGZWVkYmFjaygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zaXplTm90QWxsb3dlZCA+IDApIHtcbiAgICAgIGNvbnN0IG1pbkZpbGVTaXplID0gZm9ybWF0Qnl0ZXModGhpcy5maWxlUmVzdHJpY3Rpb25zLm1pbkZpbGVTaXplKTtcbiAgICAgIGNvbnN0IG1heEZpbGVTaXplID0gZm9ybWF0Qnl0ZXModGhpcy5maWxlUmVzdHJpY3Rpb25zLm1heEZpbGVTaXplKTtcbiAgICAgIGNvbnN0IGFyZ3MgPSBbdGhpcy5zaXplTm90QWxsb3dlZCwgbWluRmlsZVNpemUgfHwgJzAnLCBtYXhGaWxlU2l6ZV07XG4gICAgICB0aGlzLnNldFBpcGVBcmd1bWVudHMoJ2ludmFsaWRTaXplJywgYXJncyk7XG4gICAgICB0aGlzLnNpemVOb3RBbGxvd2VkID0gMDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5leHRlbnNpb25Ob3RBbGxvd2VkID4gMCkge1xuICAgICAgY29uc3QgYWxsb3dlZEV4dGVuc2lvbnNGb3JtYXR0ZWQgPSB0aGlzLmZpbGVSZXN0cmljdGlvbnMuYWxsb3dlZEV4dGVuc2lvbnMuam9pbignLCAnKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgY29uc3QgYXJncyA9IFt0aGlzLmV4dGVuc2lvbk5vdEFsbG93ZWQsIGFsbG93ZWRFeHRlbnNpb25zRm9ybWF0dGVkXTtcbiAgICAgIHRoaXMuc2V0UGlwZUFyZ3VtZW50cygnaW52YWxpZEZvcm1hdCcsIGFyZ3MpO1xuICAgICAgdGhpcy5leHRlbnNpb25Ob3RBbGxvd2VkID0gMDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5xdWFudGl0eU5vdEFsbG93ZWQgPiAwKSB7XG4gICAgICBjb25zdCBhcmdzID0gW3RoaXMucXVhbnRpdHlOb3RBbGxvd2VkXTtcbiAgICAgIHRoaXMuc2V0UGlwZUFyZ3VtZW50cygnaW52YWxpZEFtb3VudCcsIGFyZ3MpO1xuICAgICAgdGhpcy5xdWFudGl0eU5vdEFsbG93ZWQgPSAwO1xuICAgIH1cbiAgfVxuXG4gIC8qKiBNw6l0b2RvIHJlc3BvbnPDoXZlbCBwb3IgKiplbnZpYXIqKiBvKHMpIGFycXVpdm8ocykgc2VsZWNpb25hZG8ocykuICovXG4gIHNlbmRGaWxlcygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jdXJyZW50RmlsZXMgJiYgdGhpcy5jdXJyZW50RmlsZXMubGVuZ3RoKSB7XG4gICAgICB0aGlzLnVwbG9hZEZpbGVzKHRoaXMuY3VycmVudEZpbGVzKTtcbiAgICB9XG4gIH1cblxuICBzZXREaXJlY3RvcnlBdHRyaWJ1dGUoY2FuSGFuZGxlRGlyZWN0b3J5OiBib29sZWFuKSB7XG4gICAgaWYgKGNhbkhhbmRsZURpcmVjdG9yeSkge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRBdHRyaWJ1dGUodGhpcy5pbnB1dEZpbGUubmF0aXZlRWxlbWVudCwgJ3dlYmtpdGRpcmVjdG9yeScsICd0cnVlJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKHRoaXMuaW5wdXRGaWxlLm5hdGl2ZUVsZW1lbnQsICd3ZWJraXRkaXJlY3RvcnknKTtcbiAgICB9XG4gIH1cblxuICAvLyBDYXNvIG8gY29tcG9uZW50ZSBlc3RpdmVyIG5vIG1vZG8gQXV0b1VwbG9hZCwgbyBhcnF1aXZvIHRhbWLDqW0gc2Vyw6EgcmVtb3ZpZG8gZGEgbGlzdGEuXG4gIHN0b3BVcGxvYWQoZmlsZTogUG9VcGxvYWRGaWxlKSB7XG4gICAgdGhpcy51cGxvYWRTZXJ2aWNlLnN0b3BSZXF1ZXN0QnlGaWxlKGZpbGUsICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmF1dG9VcGxvYWQpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVGaWxlKGZpbGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zdG9wVXBsb2FkSGFuZGxlcihmaWxlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHRyYWNrQnlGbihpbmRleCwgZmlsZTogUG9VcGxvYWRGaWxlKSB7XG4gICAgcmV0dXJuIGZpbGUudWlkO1xuICB9XG5cbiAgLy8gRW52aWEgb3MgYXJxdWl2b3MgcGFzc2Fkb3MgcG9yIHBhcsOibWV0cm8sIGV4Y2V0byBvcyBxdWUgasOhIGZvcmFtIGVudmlhZG9zIGFvIHNlcnZpw6dvLlxuICB1cGxvYWRGaWxlcyhmaWxlczogQXJyYXk8UG9VcGxvYWRGaWxlPikge1xuICAgIGNvbnN0IGZpbGVzRmlsdGVyZWQgPSBmaWxlcy5maWx0ZXIoZmlsZSA9PiBmaWxlLnN0YXR1cyAhPT0gUG9VcGxvYWRTdGF0dXMuVXBsb2FkZWQpO1xuXG4gICAgdGhpcy51cGxvYWRTZXJ2aWNlLnVwbG9hZChcbiAgICAgIHRoaXMudXJsLFxuICAgICAgZmlsZXNGaWx0ZXJlZCxcbiAgICAgIHRoaXMub25VcGxvYWQsXG4gICAgICAoZmlsZSwgcGVyY2VudCk6IGFueSA9PiB7XG4gICAgICAgIC8vIFVQTE9BRElOR1xuICAgICAgICB0aGlzLnVwbG9hZGluZ0hhbmRsZXIoZmlsZSwgcGVyY2VudCk7XG4gICAgICB9LFxuICAgICAgKGZpbGUsIGV2ZW50UmVzcG9uc2UpOiBhbnkgPT4ge1xuICAgICAgICAvLyBTVUNDRVNTXG4gICAgICAgIHRoaXMucmVzcG9uc2VIYW5kbGVyKGZpbGUsIFBvVXBsb2FkU3RhdHVzLlVwbG9hZGVkKTtcbiAgICAgICAgdGhpcy5vblN1Y2Nlc3MuZW1pdChldmVudFJlc3BvbnNlKTtcbiAgICAgIH0sXG4gICAgICAoZmlsZSwgZXZlbnRFcnJvcik6IGFueSA9PiB7XG4gICAgICAgIC8vIEVycm9yXG4gICAgICAgIHRoaXMucmVzcG9uc2VIYW5kbGVyKGZpbGUsIFBvVXBsb2FkU3RhdHVzLkVycm9yKTtcbiAgICAgICAgdGhpcy5vbkVycm9yLmVtaXQoZXZlbnRFcnJvcik7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYW5JbnB1dFZhbHVlKCkge1xuICAgIHRoaXMuY2FsbGVkQnlDbGVhbklucHV0VmFsdWUgPSB0cnVlO1xuICAgIHRoaXMuaW5wdXRGaWxlLm5hdGl2ZUVsZW1lbnQudmFsdWUgPSAnJztcbiAgfVxuXG4gIC8vIGZ1bsOnw6NvIGRpc3BhcmFkYSBuYSByZXNwb3N0YSBkbyBzdWNlc3NvIG91IGVycm9yXG4gIHByaXZhdGUgcmVzcG9uc2VIYW5kbGVyKGZpbGU6IFBvVXBsb2FkRmlsZSwgc3RhdHVzOiBQb1VwbG9hZFN0YXR1cykge1xuICAgIGZpbGUuc3RhdHVzID0gc3RhdHVzO1xuICAgIGZpbGUucGVyY2VudCA9IDEwMDtcbiAgfVxuXG4gIC8vIG3DqXRvZG8gcmVzcG9uc8OhdmVsIHBvciBzZXRhciBvcyBhcmd1bWVudG9zIGRvIGkxOG5QaXBlIGRlIGFjb3JkbyBjb20gYSByZXN0cmnDp8Ojby5cbiAgcHJpdmF0ZSBzZXRQaXBlQXJndW1lbnRzKGxpdGVyYWxBdHRyaWJ1dGVzOiBzdHJpbmcsIGxpdGVyYWxBcmd1bWVudHM/KSB7XG4gICAgY29uc3QgcGlwZUFyZ3VtZW50cyA9IHRoaXMuaTE4blBpcGUudHJhbnNmb3JtKHRoaXMubGl0ZXJhbHNbbGl0ZXJhbEF0dHJpYnV0ZXNdLCBsaXRlcmFsQXJndW1lbnRzKTtcbiAgICB0aGlzLm5vdGlmaWNhdGlvbi5pbmZvcm1hdGlvbihwaXBlQXJndW1lbnRzKTtcbiAgfVxuXG4gIC8vIEZ1bsOnw6NvIGRpc3BhcmFkYSBhbyBwYXJhciB1bSBlbnZpbyBkZSBhcnF1aXZvLlxuICBwcml2YXRlIHN0b3BVcGxvYWRIYW5kbGVyKGZpbGU6IFBvVXBsb2FkRmlsZSkge1xuICAgIGZpbGUuc3RhdHVzID0gUG9VcGxvYWRTdGF0dXMuTm9uZTtcbiAgICBmaWxlLnBlcmNlbnQgPSAwO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVGaWxlcyhmaWxlcykge1xuICAgIHRoaXMuY3VycmVudEZpbGVzID0gdGhpcy5wYXJzZUZpbGVzKGZpbGVzKTtcblxuICAgIHRoaXMudXBkYXRlTW9kZWwoWy4uLnRoaXMuY3VycmVudEZpbGVzXSk7XG5cbiAgICBpZiAodGhpcy5hdXRvVXBsb2FkKSB7XG4gICAgICB0aGlzLnVwbG9hZEZpbGVzKHRoaXMuY3VycmVudEZpbGVzKTtcbiAgICB9XG4gIH1cblxuICAvLyBBdHVhbGl6YSBvIG5nTW9kZWwgcGFyYSBvcyBhcnF1aXZvcyBwYXNzYWRvcyBwb3IgcGFyw6JtZXRyby5cbiAgcHJpdmF0ZSB1cGRhdGVNb2RlbChmaWxlczogQXJyYXk8UG9VcGxvYWRGaWxlPikge1xuICAgIGNvbnN0IG1vZGVsRmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4gPSB0aGlzLm1hcENsZWFuVXBsb2FkRmlsZXMoZmlsZXMpO1xuICAgIHRoaXMub25Nb2RlbENoYW5nZSA/IHRoaXMub25Nb2RlbENoYW5nZShtb2RlbEZpbGVzKSA6IHRoaXMubmdNb2RlbENoYW5nZS5lbWl0KG1vZGVsRmlsZXMpO1xuICB9XG5cbiAgLy8gRnVuw6fDo28gZGlzcGFyYWRhIGVucXVhbnRvIG8gYXJxdWl2byBlc3TDoSBzZW5kbyBlbnZpYWRvIGFvIHNlcnZpw6dvLlxuICBwcml2YXRlIHVwbG9hZGluZ0hhbmRsZXIoZmlsZTogYW55LCBwZXJjZW50OiBudW1iZXIpIHtcbiAgICBmaWxlLnN0YXR1cyA9IFBvVXBsb2FkU3RhdHVzLlVwbG9hZGluZztcbiAgICBmaWxlLnBlcmNlbnQgPSBwZXJjZW50O1xuICB9XG5cbiAgLy8gcmV0b3JuYSBvcyBvYmpldG9zIGRvIGFycmF5IHNlbSBhcyBwcm9wcmllZGFkZXM6IHBlcmNlbnQgZSBkaXNwbGF5TmFtZVxuICBwcml2YXRlIG1hcENsZWFuVXBsb2FkRmlsZXMoZmlsZXM6IEFycmF5PFBvVXBsb2FkRmlsZT4pOiBBcnJheTxQb1VwbG9hZEZpbGU+IHtcbiAgICBjb25zdCBtYXBlZEJ5VXBsb2FkRmlsZSA9IHByb2dyZXNzRmlsZSA9PiB7XG4gICAgICBjb25zdCB7IHBlcmNlbnQsIGRpc3BsYXlOYW1lLCAuLi51cGxvYWRGaWxlIH0gPSBwcm9ncmVzc0ZpbGU7XG5cbiAgICAgIHJldHVybiB1cGxvYWRGaWxlO1xuICAgIH07XG5cbiAgICByZXR1cm4gZmlsZXMubWFwKG1hcGVkQnlVcGxvYWRGaWxlKTtcbiAgfVxufVxuIl19