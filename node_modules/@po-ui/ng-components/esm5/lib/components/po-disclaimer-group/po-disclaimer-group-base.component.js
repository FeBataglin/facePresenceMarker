import { __assign, __decorate, __metadata, __read, __spread } from "tslib";
import { DoCheck, EventEmitter, Input, IterableDiffers, Output, Directive } from '@angular/core';
import { v4 as uuid } from 'uuid';
import { browserLanguage, convertToBoolean, isKeyCodeEnter, poLocaleDefault } from '../../utils/util';
export var poDisclaimerGroupLiteralsDefault = {
    en: { removeAll: 'Remove all' },
    es: { removeAll: 'Eliminar todos' },
    pt: { removeAll: 'Remover todos' }
};
/**
 * @description
 *
 * O componente `po-disclaimer-group` é recomendado para manipular palavras-chave de filtros aplicados em uma pesquisa.
 *
 * À partir de dois *disclaimers* com o botão **fechar** habilitado, o componente renderiza de forma automática um novo e destacado
 * *disclaimer* que possibilita **remover todos**, mas que também pode ser desabilitado.
 *
 * Também é possível navegar entre os *disclaimers* através do teclado utilizando a tecla *tab* e, para remoção do *disclaimer* selecionado,
 * basta pressionar a tecla *enter*. Esta funcionalidade não se aplica caso a propriedade `hideClose` estiver habilitada.
 *
 * > Veja a integração destas funcionalidade no componente [po-page-list](/documentation/po-page-list).
 */
var PoDisclaimerGroupBaseComponent = /** @class */ (function () {
    function PoDisclaimerGroupBaseComponent(differs) {
        this._disclaimers = [];
        this._hideRemoveAll = false;
        this.previousDisclaimers = [];
        this.literals = __assign(__assign({}, poDisclaimerGroupLiteralsDefault[poLocaleDefault]), poDisclaimerGroupLiteralsDefault[browserLanguage()]);
        /** Função que será disparada quando a lista de *disclaimers* for modificada. */
        this.change = new EventEmitter();
        /**
         * Função que será disparada quando um *disclaimer* for removido da lista de *disclaimers* pelo usuário.
         *
         * Recebe como parâmetro um objeto conforme a interface `PoDisclaimerGroupRemoveAction`.
         */
        this.remove = new EventEmitter();
        /**
         * Função que será disparada quando todos os *disclaimers* forem removidos da lista de *disclaimers* pelo usuário,
         * utilizando o botão "remover todos".
         *
         * Recebe como parâmetro uma lista contendo todos os `disclaimers` removidos.
         */
        this.removeAll = new EventEmitter();
        this.differ = differs.find([]).create(null);
    }
    Object.defineProperty(PoDisclaimerGroupBaseComponent.prototype, "disclaimers", {
        get: function () {
            return this._disclaimers;
        },
        /** Lista de *disclaimers*. */
        /**
         * @description
         *
         * Lista de *disclaimers*.
         *
         * Para que a lista de *disclaimers* seja atualizada dinamicamente deve-se passar uma nova referência do array de `PoDisclaimer`.
         *
         * Exemplo adicionando um *disclaimer* no array:
         *
         * ```
         * this.disclaimers = [...this.disclaimers, disclaimer];
         * ```
         *
         * ou
         *
         * ```
         * this.disclaimers = this.disclaimers.concat(disclaimer);
         * ```
         */
        set: function (value) {
            this.previousDisclaimers = __spread(this.disclaimers);
            this._disclaimers = this.checkDisclaimers(value);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(PoDisclaimerGroupBaseComponent.prototype, "hideRemoveAll", {
        get: function () {
            return this._hideRemoveAll;
        },
        /**
         * @optional
         *
         * @description
         *
         * Oculta o botão para remover todos os *disclaimers* do grupo.
         *
         * > Por padrão, o mesmo é exibido à partir de dois ou mais *disclaimers* com a opção `hideClose` habilitada.
         *
         * @default `false`
         */
        set: function (value) {
            this._hideRemoveAll = value === '' ? true : convertToBoolean(value);
        },
        enumerable: true,
        configurable: true
    });
    PoDisclaimerGroupBaseComponent.prototype.ngDoCheck = function () {
        this.checkChanges();
    };
    PoDisclaimerGroupBaseComponent.prototype.onCloseAction = function (disclaimer) {
        this.removeDisclaimer(disclaimer);
        this.emitChangeDisclaimers();
        this.remove.emit({
            removedDisclaimer: __assign({}, disclaimer),
            currentDisclaimers: __spread(this.disclaimers)
        });
    };
    PoDisclaimerGroupBaseComponent.prototype.isRemoveAll = function () {
        return !this.hideRemoveAll && this.disclaimers.filter(function (c) { return !c.hideClose; }).length > 1;
    };
    PoDisclaimerGroupBaseComponent.prototype.onKeyPress = function (event) {
        if (isKeyCodeEnter(event)) {
            this.removeAllItems();
        }
    };
    PoDisclaimerGroupBaseComponent.prototype.removeAllItems = function () {
        var _this = this;
        var removeItems = [];
        this.disclaimers.forEach(function (disclaimer) {
            if (!disclaimer.hideClose) {
                removeItems.push(disclaimer);
            }
        });
        removeItems.forEach(function (disclaimer) { return _this.removeDisclaimer(disclaimer); });
        this.emitChangeDisclaimers();
        this.removeAll.emit(__spread(removeItems));
    };
    PoDisclaimerGroupBaseComponent.prototype.removeDisclaimer = function (disclaimer) {
        var itemIndex = this.disclaimers.findIndex(function (d) { return d['$id'] === disclaimer['$id']; });
        this.disclaimers.splice(itemIndex, 1);
    };
    PoDisclaimerGroupBaseComponent.prototype.checkChanges = function () {
        if (this.differ) {
            var changes = this.differ.diff(this.disclaimers);
            if (changes && this.disclaimersAreChanged(this.disclaimers)) {
                this.emitChangeDisclaimers();
            }
        }
    };
    PoDisclaimerGroupBaseComponent.prototype.checkDisclaimers = function (disclaimers) {
        if (Array.isArray(disclaimers)) {
            for (var i = 0; i < disclaimers.length; i++) {
                var disclaimer = disclaimers[i];
                if (disclaimer.value || disclaimer.value === 0 || disclaimer.value === false) {
                    disclaimer['$id'] = uuid();
                }
                else {
                    disclaimers.splice(i, 1);
                    i--;
                }
            }
            return disclaimers;
        }
        return [];
    };
    PoDisclaimerGroupBaseComponent.prototype.disclaimersAreChanged = function (disclaimers) {
        var _this = this;
        var currentValues = disclaimers;
        if (currentValues.length !== this.previousDisclaimers.length) {
            return true;
        }
        return currentValues.some(function (disclaimer, index) {
            return disclaimer.value !== _this.previousDisclaimers[index].value ||
                disclaimer.property !== _this.previousDisclaimers[index].property;
        });
    };
    PoDisclaimerGroupBaseComponent.prototype.emitChangeDisclaimers = function () {
        var _this = this;
        setTimeout(function () {
            _this.change.emit(_this.disclaimers);
        });
        this.previousDisclaimers = __spread(this._disclaimers);
    };
    PoDisclaimerGroupBaseComponent.ctorParameters = function () { return [
        { type: IterableDiffers }
    ]; };
    __decorate([
        Input('p-disclaimers'),
        __metadata("design:type", Array),
        __metadata("design:paramtypes", [Array])
    ], PoDisclaimerGroupBaseComponent.prototype, "disclaimers", null);
    __decorate([
        Input('p-hide-remove-all'),
        __metadata("design:type", Boolean),
        __metadata("design:paramtypes", [Boolean])
    ], PoDisclaimerGroupBaseComponent.prototype, "hideRemoveAll", null);
    __decorate([
        Input('p-title'),
        __metadata("design:type", String)
    ], PoDisclaimerGroupBaseComponent.prototype, "title", void 0);
    __decorate([
        Output('p-change'),
        __metadata("design:type", EventEmitter)
    ], PoDisclaimerGroupBaseComponent.prototype, "change", void 0);
    __decorate([
        Output('p-remove'),
        __metadata("design:type", EventEmitter)
    ], PoDisclaimerGroupBaseComponent.prototype, "remove", void 0);
    __decorate([
        Output('p-remove-all'),
        __metadata("design:type", EventEmitter)
    ], PoDisclaimerGroupBaseComponent.prototype, "removeAll", void 0);
    PoDisclaimerGroupBaseComponent = __decorate([
        Directive(),
        __metadata("design:paramtypes", [IterableDiffers])
    ], PoDisclaimerGroupBaseComponent);
    return PoDisclaimerGroupBaseComponent;
}());
export { PoDisclaimerGroupBaseComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tZGlzY2xhaW1lci1ncm91cC1iYXNlLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0Bwby11aS9uZy1jb21wb25lbnRzLyIsInNvdXJjZXMiOlsibGliL2NvbXBvbmVudHMvcG8tZGlzY2xhaW1lci1ncm91cC9wby1kaXNjbGFpbWVyLWdyb3VwLWJhc2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFakcsT0FBTyxFQUFFLEVBQUUsSUFBSSxJQUFJLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFFbEMsT0FBTyxFQUFFLGVBQWUsRUFBRSxnQkFBZ0IsRUFBRSxjQUFjLEVBQUUsZUFBZSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFJdEcsTUFBTSxDQUFDLElBQU0sZ0NBQWdDLEdBQUc7SUFDOUMsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRTtJQUMvQixFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7SUFDbkMsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLGVBQWUsRUFBRTtDQUNuQyxDQUFDO0FBRUY7Ozs7Ozs7Ozs7OztHQVlHO0FBRUg7SUFtRkUsd0NBQVksT0FBd0I7UUFsRjVCLGlCQUFZLEdBQXdCLEVBQUUsQ0FBQztRQUN2QyxtQkFBYyxHQUFZLEtBQUssQ0FBQztRQUdoQyx3QkFBbUIsR0FBd0IsRUFBRSxDQUFDO1FBRTdDLGFBQVEseUJBQ1osZ0NBQWdDLENBQUMsZUFBZSxDQUFDLEdBQ2pELGdDQUFnQyxDQUFDLGVBQWUsRUFBRSxDQUFDLEVBQ3REO1FBdURGLGdGQUFnRjtRQUM1RCxXQUFNLEdBQXVCLElBQUksWUFBWSxFQUFPLENBQUM7UUFFekU7Ozs7V0FJRztRQUNpQixXQUFNLEdBQXVCLElBQUksWUFBWSxFQUFP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IHsgRG9DaGVjaywgRXZlbnRFbWl0dGVyLCBJbnB1dCwgSXRlcmFibGVEaWZmZXJzLCBPdXRwdXQsIERpcmVjdGl2ZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyB2NCBhcyB1dWlkIH0gZnJvbSAndXVpZCc7XG5cbmltcG9ydCB7IGJyb3dzZXJMYW5ndWFnZSwgY29udmVydFRvQm9vbGVhbiwgaXNLZXlDb2RlRW50ZXIsIHBvTG9jYWxlRGVmYXVsdCB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuXG5pbXBvcnQgeyBQb0Rpc2NsYWltZXIgfSBmcm9tICcuLi9wby1kaXNjbGFpbWVyL3BvLWRpc2NsYWltZXIuaW50ZXJmYWNlJztcblxuZXhwb3J0IGNvbnN0IHBvRGlzY2xhaW1lckdyb3VwTGl0ZXJhbHNEZWZhdWx0ID0ge1xuICBlbjogeyByZW1vdmVBbGw6ICdSZW1vdmUgYWxsJyB9LFxuICBlczogeyByZW1vdmVBbGw6ICdFbGltaW5hciB0b2RvcycgfSxcbiAgcHQ6IHsgcmVtb3ZlQWxsOiAnUmVtb3ZlciB0b2RvcycgfVxufTtcblxuLyoqXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiBPIGNvbXBvbmVudGUgYHBvLWRpc2NsYWltZXItZ3JvdXBgIMOpIHJlY29tZW5kYWRvIHBhcmEgbWFuaXB1bGFyIHBhbGF2cmFzLWNoYXZlIGRlIGZpbHRyb3MgYXBsaWNhZG9zIGVtIHVtYSBwZXNxdWlzYS5cbiAqXG4gKiDDgCBwYXJ0aXIgZGUgZG9pcyAqZGlzY2xhaW1lcnMqIGNvbSBvIGJvdMOjbyAqKmZlY2hhcioqIGhhYmlsaXRhZG8sIG8gY29tcG9uZW50ZSByZW5kZXJpemEgZGUgZm9ybWEgYXV0b23DoXRpY2EgdW0gbm92byBlIGRlc3RhY2Fkb1xuICogKmRpc2NsYWltZXIqIHF1ZSBwb3NzaWJpbGl0YSAqKnJlbW92ZXIgdG9kb3MqKiwgbWFzIHF1ZSB0YW1iw6ltIHBvZGUgc2VyIGRlc2FiaWxpdGFkby5cbiAqXG4gKiBUYW1iw6ltIMOpIHBvc3PDrXZlbCBuYXZlZ2FyIGVudHJlIG9zICpkaXNjbGFpbWVycyogYXRyYXbDqXMgZG8gdGVjbGFkbyB1dGlsaXphbmRvIGEgdGVjbGEgKnRhYiogZSwgcGFyYSByZW1vw6fDo28gZG8gKmRpc2NsYWltZXIqIHNlbGVjaW9uYWRvLFxuICogYmFzdGEgcHJlc3Npb25hciBhIHRlY2xhICplbnRlciouIEVzdGEgZnVuY2lvbmFsaWRhZGUgbsOjbyBzZSBhcGxpY2EgY2FzbyBhIHByb3ByaWVkYWRlIGBoaWRlQ2xvc2VgIGVzdGl2ZXIgaGFiaWxpdGFkYS5cbiAqXG4gKiA+IFZlamEgYSBpbnRlZ3Jhw6fDo28gZGVzdGFzIGZ1bmNpb25hbGlkYWRlIG5vIGNvbXBvbmVudGUgW3BvLXBhZ2UtbGlzdF0oL2RvY3VtZW50YXRpb24vcG8tcGFnZS1saXN0KS5cbiAqL1xuQERpcmVjdGl2ZSgpXG5leHBvcnQgY2xhc3MgUG9EaXNjbGFpbWVyR3JvdXBCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgRG9DaGVjayB7XG4gIHByaXZhdGUgX2Rpc2NsYWltZXJzOiBBcnJheTxQb0Rpc2NsYWltZXI+ID0gW107XG4gIHByaXZhdGUgX2hpZGVSZW1vdmVBbGw6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBwcml2YXRlIGRpZmZlcjtcbiAgcHJpdmF0ZSBwcmV2aW91c0Rpc2NsYWltZXJzOiBBcnJheTxQb0Rpc2NsYWltZXI+ID0gW107XG5cbiAgcmVhZG9ubHkgbGl0ZXJhbHMgPSB7XG4gICAgLi4ucG9EaXNjbGFpbWVyR3JvdXBMaXRlcmFsc0RlZmF1bHRbcG9Mb2NhbGVEZWZhdWx0XSxcbiAgICAuLi5wb0Rpc2NsYWltZXJHcm91cExpdGVyYWxzRGVmYXVsdFticm93c2VyTGFuZ3VhZ2UoKV1cbiAgfTtcblxuICAvKiogTGlzdGEgZGUgKmRpc2NsYWltZXJzKi4gKi9cblxuICAvKipcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIExpc3RhIGRlICpkaXNjbGFpbWVycyouXG4gICAqXG4gICAqIFBhcmEgcXVlIGEgbGlzdGEgZGUgKmRpc2NsYWltZXJzKiBzZWphIGF0dWFsaXphZGEgZGluYW1pY2FtZW50ZSBkZXZlLXNlIHBhc3NhciB1bWEgbm92YSByZWZlcsOqbmNpYSBkbyBhcnJheSBkZSBgUG9EaXNjbGFpbWVyYC5cbiAgICpcbiAgICogRXhlbXBsbyBhZGljaW9uYW5kbyB1bSAqZGlzY2xhaW1lciogbm8gYXJyYXk6XG4gICAqXG4gICAqIGBgYFxuICAgKiB0aGlzLmRpc2NsYWltZXJzID0gWy4uLnRoaXMuZGlzY2xhaW1lcnMsIGRpc2NsYWltZXJdO1xuICAgKiBgYGBcbiAgICpcbiAgICogb3VcbiAgICpcbiAgICogYGBgXG4gICAqIHRoaXMuZGlzY2xhaW1lcnMgPSB0aGlzLmRpc2NsYWltZXJzLmNvbmNhdChkaXNjbGFpbWVyKTtcbiAgICogYGBgXG4gICAqL1xuICBASW5wdXQoJ3AtZGlzY2xhaW1lcnMnKSBzZXQgZGlzY2xhaW1lcnModmFsdWU6IEFycmF5PFBvRGlzY2xhaW1lcj4pIHtcbiAgICB0aGlzLnByZXZpb3VzRGlzY2xhaW1lcnMgPSBbLi4udGhpcy5kaXNjbGFpbWVyc107XG4gICAgdGhpcy5fZGlzY2xhaW1lcnMgPSB0aGlzLmNoZWNrRGlzY2xhaW1lcnModmFsdWUpO1xuICB9XG5cbiAgZ2V0IGRpc2NsYWltZXJzKCkge1xuICAgIHJldHVybiB0aGlzLl9kaXNjbGFpbWVycztcbiAgfVxuXG4gIC8qKlxuICAgKiBAb3B0aW9uYWxcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIE9jdWx0YSBvIGJvdMOjbyBwYXJhIHJlbW92ZXIgdG9kb3Mgb3MgKmRpc2NsYWltZXJzKiBkbyBncnVwby5cbiAgICpcbiAgICogPiBQb3IgcGFkcsOjbywgbyBtZXNtbyDDqSBleGliaWRvIMOgIHBhcnRpciBkZSBkb2lzIG91IG1haXMgKmRpc2NsYWltZXJzKiBjb20gYSBvcMOnw6NvIGBoaWRlQ2xvc2VgIGhhYmlsaXRhZGEuXG4gICAqXG4gICAqIEBkZWZhdWx0IGBmYWxzZWBcbiAgICovXG4gIEBJbnB1dCgncC1oaWRlLXJlbW92ZS1hbGwnKVxuICBzZXQgaGlkZVJlbW92ZUFsbCh2YWx1ZTogYm9vbGVhbikge1xuICAgIHRoaXMuX2hpZGVSZW1vdmVBbGwgPSA8YW55PnZhbHVlID09PSAnJyA/IHRydWUgOiBjb252ZXJ0VG9Cb29sZWFuKHZhbHVlKTtcbiAgfVxuXG4gIGdldCBoaWRlUmVtb3ZlQWxsKCkge1xuICAgIHJldHVybiB0aGlzLl9oaWRlUmVtb3ZlQWxsO1xuICB9XG5cbiAgLyoqIFTDrXR1bG8gZG8gZ3J1cG8gZGUgKmRpc2NsYWltZXJzKi4gKi9cbiAgQElucHV0KCdwLXRpdGxlJykgdGl0bGU/OiBzdHJpbmc7XG5cbiAgLyoqIEZ1bsOnw6NvIHF1ZSBzZXLDoSBkaXNwYXJhZGEgcXVhbmRvIGEgbGlzdGEgZGUgKmRpc2NsYWltZXJzKiBmb3IgbW9kaWZpY2FkYS4gKi9cbiAgQE91dHB1dCgncC1jaGFuZ2UnKSBjaGFuZ2U/OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIC8qKlxuICAgKiBGdW7Dp8OjbyBxdWUgc2Vyw6EgZGlzcGFyYWRhIHF1YW5kbyB1bSAqZGlzY2xhaW1lciogZm9yIHJlbW92aWRvIGRhIGxpc3RhIGRlICpkaXNjbGFpbWVycyogcGVsbyB1c3XDoXJpby5cbiAgICpcbiAgICogUmVjZWJlIGNvbW8gcGFyw6JtZXRybyB1bSBvYmpldG8gY29uZm9ybWUgYSBpbnRlcmZhY2UgYFBvRGlzY2xhaW1lckdyb3VwUmVtb3ZlQWN0aW9uYC5cbiAgICovXG4gIEBPdXRwdXQoJ3AtcmVtb3ZlJykgcmVtb3ZlPzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICAvKipcbiAgICogRnVuw6fDo28gcXVlIHNlcsOhIGRpc3BhcmFkYSBxdWFuZG8gdG9kb3Mgb3MgKmRpc2NsYWltZXJzKiBmb3JlbSByZW1vdmlkb3MgZGEgbGlzdGEgZGUgKmRpc2NsYWltZXJzKiBwZWxvIHVzdcOhcmlvLFxuICAgKiB1dGlsaXphbmRvIG8gYm90w6NvIFwicmVtb3ZlciB0b2Rvc1wiLlxuICAgKlxuICAgKiBSZWNlYmUgY29tbyBwYXLDom1ldHJvIHVtYSBsaXN0YSBjb250ZW5kbyB0b2RvcyBvcyBgZGlzY2xhaW1lcnNgIHJlbW92aWRvcy5cbiAgICovXG4gIEBPdXRwdXQoJ3AtcmVtb3ZlLWFsbCcpIHJlbW92ZUFsbD86IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG5cbiAgY29uc3RydWN0b3IoZGlmZmVyczogSXRlcmFibGVEaWZmZXJzKSB7XG4gICAgdGhpcy5kaWZmZXIgPSBkaWZmZXJzLmZpbmQoW10pLmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIG5nRG9DaGVjaygpIHtcbiAgICB0aGlzLmNoZWNrQ2hhbmdlcygpO1xuICB9XG5cbiAgb25DbG9zZUFjdGlvbihkaXNjbGFpbWVyKSB7XG4gICAgdGhpcy5yZW1vdmVEaXNjbGFpbWVyKGRpc2NsYWltZXIpO1xuXG4gICAgdGhpcy5lbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKTtcbiAgICB0aGlzLnJlbW92ZS5lbWl0KHtcbiAgICAgIHJlbW92ZWREaXNjbGFpbWVyOiB7IC4uLmRpc2NsYWltZXIgfSxcbiAgICAgIGN1cnJlbnREaXNjbGFpbWVyczogWy4uLnRoaXMuZGlzY2xhaW1lcnNdXG4gICAgfSk7XG4gIH1cblxuICBpc1JlbW92ZUFsbCgpIHtcbiAgICByZXR1cm4gIXRoaXMuaGlkZVJlbW92ZUFsbCAmJiB0aGlzLmRpc2NsYWltZXJzLmZpbHRlcihjID0+ICFjLmhpZGVDbG9zZSkubGVuZ3RoID4gMTtcbiAgfVxuXG4gIG9uS2V5UHJlc3MoZXZlbnQ6IGFueSkge1xuICAgIGlmIChpc0tleUNvZGVFbnRlcihldmVudCkpIHtcbiAgICAgIHRoaXMucmVtb3ZlQWxsSXRlbXMoKTtcbiAgICB9XG4gIH1cblxuICByZW1vdmVBbGxJdGVtcygpIHtcbiAgICBjb25zdCByZW1vdmVJdGVtcyA9IFtdO1xuXG4gICAgdGhpcy5kaXNjbGFpbWVycy5mb3JFYWNoKGRpc2NsYWltZXIgPT4ge1xuICAgICAgaWYgKCFkaXNjbGFpbWVyLmhpZGVDbG9zZSkge1xuICAgICAgICByZW1vdmVJdGVtcy5wdXNoKGRpc2NsYWltZXIpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmVtb3ZlSXRlbXMuZm9yRWFjaChkaXNjbGFpbWVyID0+IHRoaXMucmVtb3ZlRGlzY2xhaW1lcihkaXNjbGFpbWVyKSk7XG5cbiAgICB0aGlzLmVtaXRDaGFuZ2VEaXNjbGFpbWVycygpO1xuICAgIHRoaXMucmVtb3ZlQWxsLmVtaXQoWy4uLnJlbW92ZUl0ZW1zXSk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZURpc2NsYWltZXIoZGlzY2xhaW1lcjogYW55KSB7XG4gICAgY29uc3QgaXRlbUluZGV4ID0gdGhpcy5kaXNjbGFpbWVycy5maW5kSW5kZXgoZCA9PiBkWyckaWQnXSA9PT0gZGlzY2xhaW1lclsnJGlkJ10pO1xuICAgIHRoaXMuZGlzY2xhaW1lcnMuc3BsaWNlKGl0ZW1JbmRleCwgMSk7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrQ2hhbmdlcygpIHtcbiAgICBpZiAodGhpcy5kaWZmZXIpIHtcbiAgICAgIGNvbnN0IGNoYW5nZXMgPSB0aGlzLmRpZmZlci5kaWZmKHRoaXMuZGlzY2xhaW1lcnMpO1xuXG4gICAgICBpZiAoY2hhbmdlcyAmJiB0aGlzLmRpc2NsYWltZXJzQXJlQ2hhbmdlZCh0aGlzLmRpc2NsYWltZXJzKSkge1xuICAgICAgICB0aGlzLmVtaXRDaGFuZ2VEaXNjbGFpbWVycygpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tEaXNjbGFpbWVycyhkaXNjbGFpbWVyczogQXJyYXk8UG9EaXNjbGFpbWVyPikge1xuICAgIGlmIChBcnJheS5pc0FycmF5KGRpc2NsYWltZXJzKSkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaXNjbGFpbWVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBkaXNjbGFpbWVyID0gZGlzY2xhaW1lcnNbaV07XG5cbiAgICAgICAgaWYgKGRpc2NsYWltZXIudmFsdWUgfHwgZGlzY2xhaW1lci52YWx1ZSA9PT0gMCB8fCBkaXNjbGFpbWVyLnZhbHVlID09PSBmYWxzZSkge1xuICAgICAgICAgIGRpc2NsYWltZXJbJyRpZCddID0gdXVpZCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpc2NsYWltZXJzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICBpLS07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGRpc2NsYWltZXJzO1xuICAgIH1cblxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHByaXZhdGUgZGlzY2xhaW1lcnNBcmVDaGFuZ2VkKGRpc2NsYWltZXJzOiBBcnJheTxQb0Rpc2NsYWltZXI+KTogYm9vbGVhbiB7XG4gICAgY29uc3QgY3VycmVudFZhbHVlczogQXJyYXk8UG9EaXNjbGFpbWVyPiA9IGRpc2NsYWltZXJzO1xuXG4gICAgaWYgKGN1cnJlbnRWYWx1ZXMubGVuZ3RoICE9PSB0aGlzLnByZXZpb3VzRGlzY2xhaW1lcnMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3VycmVudFZhbHVlcy5zb21lKFxuICAgICAgKGRpc2NsYWltZXIsIGluZGV4KSA9PlxuICAgICAgICBkaXNjbGFpbWVyLnZhbHVlICE9PSB0aGlzLnByZXZpb3VzRGlzY2xhaW1lcnNbaW5kZXhdLnZhbHVlIHx8XG4gICAgICAgIGRpc2NsYWltZXIucHJvcGVydHkgIT09IHRoaXMucHJldmlvdXNEaXNjbGFpbWVyc1tpbmRleF0ucHJvcGVydHlcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0Q2hhbmdlRGlzY2xhaW1lcnMoKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmNoYW5nZS5lbWl0KHRoaXMuZGlzY2xhaW1lcnMpO1xuICAgIH0pO1xuICAgIHRoaXMucHJldmlvdXNEaXNjbGFpbWVycyA9IFsuLi50aGlzLl9kaXNjbGFpbWVyc107XG4gIH1cbn1cbiJdfQ==