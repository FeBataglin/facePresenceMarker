import { __assign, __decorate, __metadata } from "tslib";
import { Injectable } from '@angular/core';
import { HttpClient, HttpErrorResponse, HttpHeaders, HttpParams } from '@angular/common/http';
import { merge, of, throwError } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import { PoLanguageService, PoNotificationService } from '@po-ui/ng-components';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@po-ui/ng-components";
export var poPageDynamicLiterals = {
    en: {
        errorRenderPage: 'Error loading page',
        notPossibleLoadMetadataPage: 'The page metadata could not be loaded'
    },
    es: {
        errorRenderPage: 'Error al cargar la página',
        notPossibleLoadMetadataPage: 'No se pudieron cargar los metadatos de la página.'
    },
    pt: {
        errorRenderPage: 'Erro ao carregar a página',
        notPossibleLoadMetadataPage: 'Não foi possível carregar os metadados da página'
    },
    ru: {
        errorRenderPage: 'Ошибка загрузки страницы',
        notPossibleLoadMetadataPage: 'Не удалось загрузить метаданные страницы'
    }
};
var PoPageDynamicService = /** @class */ (function () {
    function PoPageDynamicService(http, notification, languageService) {
        this.http = http;
        this.notification = notification;
        this.endpoint = '/';
        this.headers = new HttpHeaders({
            'X-PO-SCREEN-LOCK': 'true'
        });
        this.language = languageService.getShortLanguage();
    }
    PoPageDynamicService.prototype.configServiceApi = function (config) {
        if (config === void 0) { config = {}; }
        this.endpoint = config.endpoint;
        this.metadata = config.metadata || this.metadata;
    };
    PoPageDynamicService.prototype.getMetadata = function (type) {
        var _this = this;
        if (type === void 0) { type = 'list'; }
        var key = this.endpoint + "-" + type + "-metadata";
        var cache = JSON.parse(localStorage.getItem(key)) || {};
        var metadataUrlBase = this.metadata || this.endpoint + "/metadata";
        var url = metadataUrlBase + "?type=" + type + "&version=" + (cache.version || '');
        return this.http.get(url).pipe(map(function (response) {
            if (response.version !== undefined && response.version === cache.version) {
                return cache;
            }
            localStorage.setItem(key, JSON.stringify(response));
            return __assign(__assign({}, cache), response);
        }), catchError(function (error) {
            if (Object.keys(cache).length) {
                return of(cache);
            }
            var _a = poPageDynamicLiterals[_this.language], errorRenderPage = _a.errorRenderPage, notPossibleLoadMetadataPage = _a.notPossibleLoadMetadataPage;
            _this.notification.warning(notPossibleLoadMetadataPage);
            return merge(of({ title: errorRenderPage }), throwError(error));
        }));
    };
    // Deleta um único recurso
    PoPageDynamicService.prototype.deleteResource = function (id, endpoint) {
        return this.http.delete(this.getLocalEndPoint(endpoint, true) + "/" + id, { headers: this.headers });
    };
    // Deleta recursos em lote
    PoPageDynamicService.prototype.deleteResources = function (ids, endpoint) {
        return this.http.request('delete', "" + this.getLocalEndPoint(endpoint), { headers: this.headers, body: ids });
    };
    // Busca uma lista de recursos
    PoPageDynamicService.prototype.getResources = function (params, endpoint) {
        return this.http.get(this.getLocalEndPoint(endpoint), { headers: this.headers, params: params });
    };
    // Busca um único recurso
    PoPageDynamicService.prototype.getResource = function (id, endpoint) {
        return this.http.get(this.getLocalEndPoint(endpoint, true) + "/" + id, { headers: this.headers });
    };
    // Cria um recurso
    PoPageDynamicService.prototype.createResource = function (resource, endpoint) {
        return this.http.post("" + this.getLocalEndPoint(endpoint), resource, { headers: this.headers });
    };
    // Atualiza um recurso
    PoPageDynamicService.prototype.updateResource = function (id, resource, endpoint) {
        return this.http.put(this.getLocalEndPoint(endpoint, true) + "/" + id, resource, { headers: this.headers });
    };
    PoPageDynamicService.prototype.getLocalEndPoint = function (endpoint, checkSingleBar) {
        if (checkSingleBar === void 0) { checkSingleBar = false; }
        endpoint = endpoint !== null && endpoint !== void 0 ? endpoint : this.endpoint;
        if (checkSingleBar) {
            endpoint = endpoint === '/' ? '' : endpoint;
        }
        return endpoint;
    };
    PoPageDynamicService.ctorParameters = function () { return [
        { type: HttpClient },
        { type: PoNotificationService },
        { type: PoLanguageService }
    ]; };
    PoPageDynamicService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PoPageDynamicService_Factory() { return new PoPageDynamicService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.PoNotificationService), i0.ɵɵinject(i2.PoLanguageService)); }, token: PoPageDynamicService, providedIn: "root" });
    PoPageDynamicService = __decorate([
        Injectable({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [HttpClient,
            PoNotificationService,
            PoLanguageService])
    ], PoPageDynamicService);
    return PoPageDynamicService;
}());
export { PoPageDynamicService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1keW5hbWljLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG8tdWkvbmctdGVtcGxhdGVzLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3BvLXBhZ2UtZHluYW1pYy9wby1wYWdlLWR5bmFtaWMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUU5RixPQUFPLEVBQUUsS0FBSyxFQUFjLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDekQsT0FBTyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVqRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7OztBQUloRixNQUFNLENBQUMsSUFBTSxxQkFBcUIsR0FBNkM7SUFDN0UsRUFBRSxFQUFFO1FBQ0YsZUFBZSxFQUFFLG9CQUFvQjtRQUNyQywyQkFBMkIsRUFBRSx1Q0FBdUM7S0FDckU7SUFDRCxFQUFFLEVBQUU7UUFDRixlQUFlLEVBQUUsMkJBQTJCO1FBQzVDLDJCQUEyQixFQUFFLG1EQUFtRDtLQUNqRjtJQUNELEVBQUUsRUFBRTtRQUNGLGVBQWUsRUFBRSwyQkFBMkI7UUFDNUMsMkJBQTJCLEVBQUUsa0RBQWtEO0tBQ2hGO0lBQ0QsRUFBRSxFQUFFO1FBQ0YsZUFBZSxFQUFFLDBCQUEwQjtRQUMzQywyQkFBMkIsRUFBRSwwQ0FBMEM7S0FDeEU7Q0FDRixDQUFDO0FBS0Y7SUFTRSw4QkFDVSxJQUFnQixFQUNoQixZQUFtQyxFQUMzQyxlQUFrQztRQUYxQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLGlCQUFZLEdBQVosWUFBWSxDQUF1QjtRQVZyQyxhQUFR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QUFSLFFBQVEsR0FBSSxJQUFJLENBQUMsUUFBUSxDQUFDO1FBQ3JDLElBQUksY0FBYyxFQUFFO1lBQ2xCLFFBQVEsR0FBRyxRQUFRLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQztTQUM3QztRQUNELE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUM7O2dCQS9FZSxVQUFVO2dCQUNGLHFCQUFxQjtnQkFDMUIsaUJBQWlCOzs7SUFaekIsb0JBQW9CO1FBSGhDLFVBQVUsQ0FBQztZQUNWLFVBQVUsRUFBRSxNQUFNO1NBQ25CLENBQUM7eUNBV2dCLFVBQVU7WUFDRixxQkFBcUI7WUFDMUIsaUJBQWlCO09BWnpCLG9CQUFvQixDQTBGaEM7K0JBMUhEO0NBMEhDLEFBMUZELElBMEZDO1NBMUZZLG9CQUFvQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBFcnJvclJlc3BvbnNlLCBIdHRwSGVhZGVycywgSHR0cFBhcmFtcyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcblxuaW1wb3J0IHsgbWVyZ2UsIE9ic2VydmFibGUsIG9mLCB0aHJvd0Vycm9yIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAsIGNhdGNoRXJyb3IgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IFBvTGFuZ3VhZ2VTZXJ2aWNlLCBQb05vdGlmaWNhdGlvblNlcnZpY2UgfSBmcm9tICdAcG8tdWkvbmctY29tcG9uZW50cyc7XG5cbmltcG9ydCB7IFBvUGFnZUR5bmFtaWNMaXRlcmFscyB9IGZyb20gJy4vcG8tcGFnZS1keW5hbWljLWxpdGVyYWxzLmludGVyZmFjZSc7XG5cbmV4cG9ydCBjb25zdCBwb1BhZ2VEeW5hbWljTGl0ZXJhbHM6IHsgW2tleTogc3RyaW5nXTogUG9QYWdlRHluYW1pY0xpdGVyYWxzIH0gPSB7XG4gIGVuOiB7XG4gICAgZXJyb3JSZW5kZXJQYWdlOiAnRXJyb3IgbG9hZGluZyBwYWdlJyxcbiAgICBub3RQb3NzaWJsZUxvYWRNZXRhZGF0YVBhZ2U6ICdUaGUgcGFnZSBtZXRhZGF0YSBjb3VsZCBub3QgYmUgbG9hZGVkJ1xuICB9LFxuICBlczoge1xuICAgIGVycm9yUmVuZGVyUGFnZTogJ0Vycm9yIGFsIGNhcmdhciBsYSBww6FnaW5hJyxcbiAgICBub3RQb3NzaWJsZUxvYWRNZXRhZGF0YVBhZ2U6ICdObyBzZSBwdWRpZXJvbiBjYXJnYXIgbG9zIG1ldGFkYXRvcyBkZSBsYSBww6FnaW5hLidcbiAgfSxcbiAgcHQ6IHtcbiAgICBlcnJvclJlbmRlclBhZ2U6ICdFcnJvIGFvIGNhcnJlZ2FyIGEgcMOhZ2luYScsXG4gICAgbm90UG9zc2libGVMb2FkTWV0YWRhdGFQYWdlOiAnTsOjbyBmb2kgcG9zc8OtdmVsIGNhcnJlZ2FyIG9zIG1ldGFkYWRvcyBkYSBww6FnaW5hJ1xuICB9LFxuICBydToge1xuICAgIGVycm9yUmVuZGVyUGFnZTogJ9Ce0YjQuNCx0LrQsCDQt9Cw0LPRgNGD0LfQutC4INGB0YLRgNCw0L3QuNGG0YsnLFxuICAgIG5vdFBvc3NpYmxlTG9hZE1ldGFkYXRhUGFnZTogJ9Cd0LUg0YPQtNCw0LvQvtGB0Ywg0LfQsNCz0YDRg9C30LjRgtGMINC80LXRgtCw0LTQsNC90L3Ri9C1INGB0YLRgNCw0L3QuNGG0YsnXG4gIH1cbn07XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFBvUGFnZUR5bmFtaWNTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBlbmRwb2ludCA9ICcvJztcbiAgcHJpdmF0ZSBsYW5ndWFnZTogc3RyaW5nO1xuICBwcml2YXRlIG1ldGFkYXRhOiBzdHJpbmc7XG5cbiAgcmVhZG9ubHkgaGVhZGVyczogSHR0cEhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoe1xuICAgICdYLVBPLVNDUkVFTi1MT0NLJzogJ3RydWUnXG4gIH0pO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCxcbiAgICBwcml2YXRlIG5vdGlmaWNhdGlvbjogUG9Ob3RpZmljYXRpb25TZXJ2aWNlLFxuICAgIGxhbmd1YWdlU2VydmljZTogUG9MYW5ndWFnZVNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy5sYW5ndWFnZSA9IGxhbmd1YWdlU2VydmljZS5nZXRTaG9ydExhbmd1YWdlKCk7XG4gIH1cblxuICBjb25maWdTZXJ2aWNlQXBpKGNvbmZpZzogeyBlbmRwb2ludD86IHN0cmluZzsgbWV0YWRhdGE/OiBzdHJpbmcgfSA9IHt9KSB7XG4gICAgdGhpcy5lbmRwb2ludCA9IGNvbmZpZy5lbmRwb2ludDtcbiAgICB0aGlzLm1ldGFkYXRhID0gY29uZmlnLm1ldGFkYXRhIHx8IHRoaXMubWV0YWRhdGE7XG4gIH1cblxuICBnZXRNZXRhZGF0YTxUPih0eXBlOiBzdHJpbmcgPSAnbGlzdCcpOiBPYnNlcnZhYmxlPFQ+IHtcbiAgICBjb25zdCBrZXkgPSBgJHt0aGlzLmVuZHBvaW50fS0ke3R5cGV9LW1ldGFkYXRhYDtcbiAgICBjb25zdCBjYWNoZSA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KSkgfHwge307XG4gICAgY29uc3QgbWV0YWRhdGFVcmxCYXNlID0gdGhpcy5tZXRhZGF0YSB8fCBgJHt0aGlzLmVuZHBvaW50fS9tZXRhZGF0YWA7XG5cbiAgICBjb25zdCB1cmwgPSBgJHttZXRhZGF0YVVybEJhc2V9P3R5cGU9JHt0eXBlfSZ2ZXJzaW9uPSR7Y2FjaGUudmVyc2lvbiB8fCAnJ31gO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8VD4odXJsKS5waXBlKFxuICAgICAgbWFwKChyZXNwb25zZTogYW55KSA9PiB7XG4gICAgICAgIGlmIChyZXNwb25zZS52ZXJzaW9uICE9PSB1bmRlZmluZWQgJiYgcmVzcG9uc2UudmVyc2lvbiA9PT0gY2FjaGUudmVyc2lvbikge1xuICAgICAgICAgIHJldHVybiBjYWNoZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkocmVzcG9uc2UpKTtcblxuICAgICAgICByZXR1cm4geyAuLi5jYWNoZSwgLi4ucmVzcG9uc2UgfTtcbiAgICAgIH0pLFxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhjYWNoZSkubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG9mKGNhY2hlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgZXJyb3JSZW5kZXJQYWdlLCBub3RQb3NzaWJsZUxvYWRNZXRhZGF0YVBhZ2UgfSA9IHBvUGFnZUR5bmFtaWNMaXRlcmFsc1t0aGlzLmxhbmd1YWdlXTtcblxuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbi53YXJuaW5nKG5vdFBvc3NpYmxlTG9hZE1ldGFkYXRhUGFnZSk7XG5cbiAgICAgICAgcmV0dXJuIG1lcmdlKG9mKHsgdGl0bGU6IGVycm9yUmVuZGVyUGFnZSB9KSwgdGhyb3dFcnJvcihlcnJvcikpO1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgLy8gRGVsZXRhIHVtIMO6bmljbyByZWN1cnNvXG4gIGRlbGV0ZVJlc291cmNlKGlkLCBlbmRwb2ludD86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5kZWxldGUoYCR7dGhpcy5nZXRMb2NhbEVuZFBvaW50KGVuZHBvaW50LCB0cnVlKX0vJHtpZH1gLCB7IGhlYWRlcnM6IHRoaXMuaGVhZGVycyB9KTtcbiAgfVxuXG4gIC8vIERlbGV0YSByZWN1cnNvcyBlbSBsb3RlXG4gIGRlbGV0ZVJlc291cmNlcyhpZHM6IEFycmF5PGFueT4sIGVuZHBvaW50Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLnJlcXVlc3QoJ2RlbGV0ZScsIGAke3RoaXMuZ2V0TG9jYWxFbmRQb2ludChlbmRwb2ludCl9YCwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsIGJvZHk6IGlkcyB9KTtcbiAgfVxuXG4gIC8vIEJ1c2NhIHVtYSBsaXN0YSBkZSByZWN1cnNvc1xuICBnZXRSZXNvdXJjZXMocGFyYW1zPzogSHR0cFBhcmFtcywgZW5kcG9pbnQ/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHRoaXMuZ2V0TG9jYWxFbmRQb2ludChlbmRwb2ludCksIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzLCBwYXJhbXMgfSk7XG4gIH1cblxuICAvLyBCdXNjYSB1bSDDum5pY28gcmVjdXJzb1xuICBnZXRSZXNvdXJjZShpZCwgZW5kcG9pbnQ/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KGAke3RoaXMuZ2V0TG9jYWxFbmRQb2ludChlbmRwb2ludCwgdHJ1ZSl9LyR7aWR9YCwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMgfSk7XG4gIH1cblxuICAvLyBDcmlhIHVtIHJlY3Vyc29cbiAgY3JlYXRlUmVzb3VyY2UocmVzb3VyY2UsIGVuZHBvaW50Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3QoYCR7dGhpcy5nZXRMb2NhbEVuZFBvaW50KGVuZHBvaW50KX1gLCByZXNvdXJjZSwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMgfSk7XG4gIH1cblxuICAvLyBBdHVhbGl6YSB1bSByZWN1cnNvXG4gIHVwZGF0ZVJlc291cmNlKGlkLCByZXNvdXJjZSwgZW5kcG9pbnQ/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAucHV0KGAke3RoaXMuZ2V0TG9jYWxFbmRQb2ludChlbmRwb2ludCwgdHJ1ZSl9LyR7aWR9YCwgcmVzb3VyY2UsIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRMb2NhbEVuZFBvaW50KGVuZHBvaW50Pzogc3RyaW5nLCBjaGVja1NpbmdsZUJhciA9IGZhbHNlKSB7XG4gICAgZW5kcG9pbnQgPSBlbmRwb2ludCA/PyB0aGlzLmVuZHBvaW50O1xuICAgIGlmIChjaGVja1NpbmdsZUJhcikge1xuICAgICAgZW5kcG9pbnQgPSBlbmRwb2ludCA9PT0gJy8nID8gJycgOiBlbmRwb2ludDtcbiAgICB9XG4gICAgcmV0dXJuIGVuZHBvaW50O1xuICB9XG59XG4iXX0=