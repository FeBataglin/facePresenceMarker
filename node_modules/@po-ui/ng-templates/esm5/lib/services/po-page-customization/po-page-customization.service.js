import { __assign, __decorate, __metadata, __read, __spread } from "tslib";
import { HttpClient } from '@angular/common/http';
import { Injectable } from '@angular/core';
import { from } from 'rxjs';
import { map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
var PoPageCustomizationService = /** @class */ (function () {
    function PoPageCustomizationService(http) {
        this.http = http;
    }
    PoPageCustomizationService.prototype.getCustomOptions = function (origin, originalOption, optionSchema) {
        var _this = this;
        return this.createObservable(origin).pipe(map(function (newPageOptions) { return _this.mergePageOptions(originalOption, newPageOptions, optionSchema); }));
    };
    PoPageCustomizationService.prototype.changeOriginalOptionsToNewOptions = function (objectToChange, newOptions) {
        Object.keys(newOptions).forEach(function (key) {
            var value = newOptions[key];
            if (objectToChange[key] !== undefined) {
                if (Array.isArray(value)) {
                    objectToChange[key] = __spread(value);
                    return;
                }
                if (typeof value === 'number' || typeof value === 'string' || typeof value === 'boolean') {
                    objectToChange[key] = value;
                    return;
                }
                if (value !== null && typeof value === 'object') {
                    objectToChange[key] = __assign({}, value);
                }
            }
        });
    };
    PoPageCustomizationService.prototype.createObservable = function (origin) {
        if (typeof origin === 'string') {
            return this.http.post(origin, {});
        }
        return from(Promise.resolve(origin()));
    };
    PoPageCustomizationService.prototype.mergePageOptions = function (originalOption, newPageOptions, optionSchema) {
        var _this = this;
        var mergePageOptions = optionSchema.schema.reduce(function (objWithNewProp, prop) {
            var _a;
            return (__assign(__assign({}, objWithNewProp), (_a = {}, _a[prop.nameProp] = _this.createNewProp(prop, originalOption, newPageOptions), _a)));
        }, {});
        Object.keys(mergePageOptions).forEach(function (key) { return mergePageOptions[key] === undefined && delete mergePageOptions[key]; });
        return mergePageOptions;
    };
    PoPageCustomizationService.prototype.createNewProp = function (prop, originalOption, newPageOptions) {
        var _a;
        if (prop.merge) {
            return this.mergeOptions(originalOption[prop.nameProp], newPageOptions[prop.nameProp], prop.keyForMerge);
        }
        else {
            return (_a = newPageOptions[prop.nameProp]) !== null && _a !== void 0 ? _a : originalOption[prop.nameProp];
        }
    };
    PoPageCustomizationService.prototype.mergeOptions = function (originalOptions, newOptions, filterProp) {
        if (!originalOptions && !newOptions) {
            return;
        }
        if (!newOptions) {
            return originalOptions;
        }
        if (!originalOptions) {
            return newOptions;
        }
        if (originalOptions instanceof Array && newOptions instanceof Array) {
            return this.mergeOptionsArray(originalOptions, newOptions, filterProp);
        }
        return __assign(__assign({}, originalOptions), newOptions);
    };
    PoPageCustomizationService.prototype.mergeOptionsArray = function (originalOptions, newOptions, filterProp) {
        var deduplicateNewOptions = newOptions.filter(function (newItem) { return !originalOptions.find(function (originalItem) { return originalItem[filterProp] === newItem[filterProp]; }); });
        var mergedOriginalOptions = originalOptions.map(function (originalItem) {
            var newItem = newOptions.find(function (newOptionsItem) { return originalItem[filterProp] === newOptionsItem[filterProp]; }) || originalItem;
            return __assign(__assign({}, originalItem), newItem);
        });
        return __spread(mergedOriginalOptions, deduplicateNewOptions);
    };
    PoPageCustomizationService.ctorParameters = function () { return [
        { type: HttpClient }
    ]; };
    PoPageCustomizationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PoPageCustomizationService_Factory() { return new PoPageCustomizationService(i0.ɵɵinject(i1.HttpClient)); }, token: PoPageCustomizationService, providedIn: "root" });
    PoPageCustomizationService = __decorate([
        Injectable({
            providedIn: 'root'
        }),
        __metadata("design:paramtypes", [HttpClient])
    ], PoPageCustomizationService);
    return PoPageCustomizationService;
}());
export { PoPageCustomizationService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1jdXN0b21pemF0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG8tdWkvbmctdGVtcGxhdGVzLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3BvLXBhZ2UtY3VzdG9taXphdGlvbi9wby1wYWdlLWN1c3RvbWl6YXRpb24uc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFjLElBQUksRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN4QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7OztBQVNyQztJQUNFLG9DQUFvQixJQUFnQjtRQUFoQixTQUFJLEdBQUosSUFBSSxDQUFZO0lBQUcsQ0FBQztJQUV4QyxxREFBZ0IsR0FBaEIsVUFDRSxNQUFxQixFQUNyQixjQUFpQixFQUNqQixZQUEyQztRQUg3QyxpQkFRQztRQUhDLE9BQU8sSUFBSSxDQUFDLGdCQUFnQixDQUFJLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FDMUMsR0FBRyxDQUFDLFVBQUEsY0FBYyxJQUFJLE9BQUEsS0FBSSxDQUFDLGdCQUFnQixDQUFJLGNBQWMsRUFBRSxjQUFjLEVBQUUsWUFBWSxDQUFDLEVBQXRFLENBQXNFLENBQUMsQ0FDOUYsQ0FBQztJQUNKLENBQUM7SUFFRCxzRUFBaUMsR0FBakMsVUFBd0MsY0FBaUIsRUFBRSxVQUFhO1FBQ3RFLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQUEsR0FBRztZQUNqQyxJQUFNLEtBQUssR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDOUIsSUFBSSxjQUFjLENBQUMsR0FBRyxDQUFDLEtBQUssU0FBUyxFQUFFO2dCQUNyQyxJQUFJLEtBQUssQ0FBQyxPQUFPLENBQUMs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Qy9GLElBQU0scUJBQXFCLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FDN0MsVUFBQSxPQUFPLElBQUksT0FBQSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsVUFBQSxZQUFZLElBQUksT0FBQSxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFoRCxDQUFnRCxDQUFDLEVBQXZGLENBQXVGLENBQ25HLENBQUM7UUFDRixJQUFNLHFCQUFxQixHQUFHLGVBQWUsQ0FBQyxHQUFHLENBQUMsVUFBQSxZQUFZO1lBQzVELElBQU0sT0FBTyxHQUNYLFVBQVUsQ0FBQyxJQUFJLENBQUMsVUFBQSxjQUFjLElBQUksT0FBQSxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssY0FBYyxDQUFDLFVBQVUsQ0FBQyxFQUF2RCxDQUF1RCxDQUFDLElBQUksWUFBWSxDQUFDO1lBQzdHLDZCQUFZLFlBQVksR0FBSyxPQUFPLEVBQUc7UUFDekMsQ0FBQyxDQUFDLENBQUM7UUFDSCxnQkFBVyxxQkFBcUIsRUFBSyxxQkFBcUIsRUFBRTtJQUM5RCxDQUFDOztnQkF4RnlCLFVBQVU7OztJQUR6QiwwQkFBMEI7UUFIdEMsVUFBVSxDQUFDO1lBQ1YsVUFBVSxFQUFFLE1BQU07U0FDbkIsQ0FBQzt5Q0FFMEIsVUFBVTtPQUR6QiwwQkFBMEIsQ0EwRnRDO3FDQXZHRDtDQXVHQyxBQTFGRCxJQTBGQztTQTFGWSwwQkFBMEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBmcm9tIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbmltcG9ydCB7IFBvUGFnZUR5bmFtaWNPcHRpb25zU2NoZW1hLCBQb1BhZ2VEeW5hbWljT3B0aW9uc1Byb3AgfSBmcm9tICcuL3BvLXBhZ2UtZHluYW1pYy1vcHRpb25zLmludGVyZmFjZSc7XG5cbnR5cGUgdXJsT3JGdW5jdGlvbiA9IHN0cmluZyB8IEZ1bmN0aW9uO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290J1xufSlcbmV4cG9ydCBjbGFzcyBQb1BhZ2VDdXN0b21pemF0aW9uU2VydmljZSB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge31cblxuICBnZXRDdXN0b21PcHRpb25zPFQ+KFxuICAgIG9yaWdpbjogdXJsT3JGdW5jdGlvbixcbiAgICBvcmlnaW5hbE9wdGlvbjogVCxcbiAgICBvcHRpb25TY2hlbWE6IFBvUGFnZUR5bmFtaWNPcHRpb25zU2NoZW1hPFQ+XG4gICk6IE9ic2VydmFibGU8VD4ge1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZU9ic2VydmFibGU8VD4ob3JpZ2luKS5waXBlKFxuICAgICAgbWFwKG5ld1BhZ2VPcHRpb25zID0+IHRoaXMubWVyZ2VQYWdlT3B0aW9uczxUPihvcmlnaW5hbE9wdGlvbiwgbmV3UGFnZU9wdGlvbnMsIG9wdGlvblNjaGVtYSkpXG4gICAgKTtcbiAgfVxuXG4gIGNoYW5nZU9yaWdpbmFsT3B0aW9uc1RvTmV3T3B0aW9uczxULCBLPihvYmplY3RUb0NoYW5nZTogVCwgbmV3T3B0aW9uczogSykge1xuICAgIE9iamVjdC5rZXlzKG5ld09wdGlvbnMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGNvbnN0IHZhbHVlID0gbmV3T3B0aW9uc1trZXldO1xuICAgICAgaWYgKG9iamVjdFRvQ2hhbmdlW2tleV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgICBvYmplY3RUb0NoYW5nZVtrZXldID0gWy4uLnZhbHVlXTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgfHwgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICAgIG9iamVjdFRvQ2hhbmdlW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICBvYmplY3RUb0NoYW5nZVtrZXldID0geyAuLi52YWx1ZSB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZU9ic2VydmFibGU8VD4ob3JpZ2luOiB1cmxPckZ1bmN0aW9uKTogT2JzZXJ2YWJsZTxUPiB7XG4gICAgaWYgKHR5cGVvZiBvcmlnaW4gPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8VD4ob3JpZ2luLCB7fSk7XG4gICAgfVxuICAgIHJldHVybiBmcm9tKFByb21pc2UucmVzb2x2ZShvcmlnaW4oKSkpO1xuICB9XG5cbiAgcHJpdmF0ZSBtZXJnZVBhZ2VPcHRpb25zPFQ+KG9yaWdpbmFsT3B0aW9uOiBULCBuZXdQYWdlT3B0aW9uczogVCwgb3B0aW9uU2NoZW1hOiBQb1BhZ2VEeW5hbWljT3B0aW9uc1NjaGVtYTxUPikge1xuICAgIGNvbnN0IG1lcmdlUGFnZU9wdGlvbnM6IFQgPSBvcHRpb25TY2hlbWEuc2NoZW1hLnJlZHVjZShcbiAgICAgIChvYmpXaXRoTmV3UHJvcCwgcHJvcCkgPT4gKHtcbiAgICAgICAgLi4ub2JqV2l0aE5ld1Byb3AsXG4gICAgICAgIFtwcm9wLm5hbWVQcm9wXTogdGhpcy5jcmVhdGVOZXdQcm9wKHByb3AsIG9yaWdpbmFsT3B0aW9uLCBuZXdQYWdlT3B0aW9ucylcbiAgICAgIH0pLFxuICAgICAge30gYXMgVFxuICAgICk7XG5cbiAgICBPYmplY3Qua2V5cyhtZXJnZVBhZ2VPcHRpb25zKS5mb3JFYWNoKGtleSA9PiBtZXJnZVBhZ2VPcHRpb25zW2tleV0gPT09IHVuZGVmaW5lZCAmJiBkZWxldGUgbWVyZ2VQYWdlT3B0aW9uc1trZXldKTtcblxuICAgIHJldHVybiBtZXJnZVBhZ2VPcHRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVOZXdQcm9wPFQ+KHByb3A6IFBvUGFnZUR5bmFtaWNPcHRpb25zUHJvcDxUPiwgb3JpZ2luYWxPcHRpb246IFQsIG5ld1BhZ2VPcHRpb25zOiBUKSB7XG4gICAgaWYgKHByb3AubWVyZ2UpIHtcbiAgICAgIHJldHVybiB0aGlzLm1lcmdlT3B0aW9ucyhvcmlnaW5hbE9wdGlvbltwcm9wLm5hbWVQcm9wXSwgbmV3UGFnZU9wdGlvbnNbcHJvcC5uYW1lUHJvcF0sIHByb3Aua2V5Rm9yTWVyZ2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbmV3UGFnZU9wdGlvbnNbcHJvcC5uYW1lUHJvcF0gPz8gb3JpZ2luYWxPcHRpb25bcHJvcC5uYW1lUHJvcF07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBtZXJnZU9wdGlvbnM8VD4ob3JpZ2luYWxPcHRpb25zOiBBcnJheTxUPiB8IFQsIG5ld09wdGlvbnM6IEFycmF5PFQ+IHwgVCwgZmlsdGVyUHJvcD86IGtleW9mIFQpIHtcbiAgICBpZiAoIW9yaWdpbmFsT3B0aW9ucyAmJiAhbmV3T3B0aW9ucykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIW5ld09wdGlvbnMpIHtcbiAgICAgIHJldHVybiBvcmlnaW5hbE9wdGlvbnM7XG4gICAgfVxuICAgIGlmICghb3JpZ2luYWxPcHRpb25zKSB7XG4gICAgICByZXR1cm4gbmV3T3B0aW9ucztcbiAgICB9XG5cbiAgICBpZiAob3JpZ2luYWxPcHRpb25zIGluc3RhbmNlb2YgQXJyYXkgJiYgbmV3T3B0aW9ucyBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICByZXR1cm4gdGhpcy5tZXJnZU9wdGlvbnNBcnJheShvcmlnaW5hbE9wdGlvbnMsIG5ld09wdGlvbnMsIGZpbHRlclByb3ApO1xuICAgIH1cblxuICAgIHJldHVybiB7IC4uLm9yaWdpbmFsT3B0aW9ucywgLi4ubmV3T3B0aW9ucyB9O1xuICB9XG5cbiAgcHJpdmF0ZSBtZXJnZU9wdGlvbnNBcnJheTxUPihvcmlnaW5hbE9wdGlvbnM6IEFycmF5PFQ+LCBuZXdPcHRpb25zOiBBcnJheTxUPiwgZmlsdGVyUHJvcDoga2V5b2YgVCkge1xuICAgIGNvbnN0IGRlZHVwbGljYXRlTmV3T3B0aW9ucyA9IG5ld09wdGlvbnMuZmlsdGVyKFxuICAgICAgbmV3SXRlbSA9PiAhb3JpZ2luYWxPcHRpb25zLmZpbmQob3JpZ2luYWxJdGVtID0+IG9yaWdpbmFsSXRlbVtmaWx0ZXJQcm9wXSA9PT0gbmV3SXRlbVtmaWx0ZXJQcm9wXSlcbiAgICApO1xuICAgIGNvbnN0IG1lcmdlZE9yaWdpbmFsT3B0aW9ucyA9IG9yaWdpbmFsT3B0aW9ucy5tYXAob3JpZ2luYWxJdGVtID0+IHtcbiAgICAgIGNvbnN0IG5ld0l0ZW0gPVxuICAgICAgICBuZXdPcHRpb25zLmZpbmQobmV3T3B0aW9uc0l0ZW0gPT4gb3JpZ2luYWxJdGVtW2ZpbHRlclByb3BdID09PSBuZXdPcHRpb25zSXRlbVtmaWx0ZXJQcm9wXSkgfHwgb3JpZ2luYWxJdGVtO1xuICAgICAgcmV0dXJuIHsgLi4ub3JpZ2luYWxJdGVtLCAuLi5uZXdJdGVtIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIFsuLi5tZXJnZWRPcmlnaW5hbE9wdGlvbnMsIC4uLmRlZHVwbGljYXRlTmV3T3B0aW9uc107XG4gIH1cbn1cbiJdfQ==