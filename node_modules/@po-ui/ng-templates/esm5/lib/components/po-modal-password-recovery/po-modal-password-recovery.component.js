import { __decorate, __extends, __metadata } from "tslib";
import { Component, ViewChild } from '@angular/core';
import { NgForm } from '@angular/forms';
import { Router } from '@angular/router';
import { isExternalLink } from '../../utils/util';
import { PoI18nPipe, PoModalAction, PoModalComponent, PoRadioGroupOption } from '@po-ui/ng-components';
import { PoModalPasswordRecoveryBaseComponent } from './po-modal-password-recovery-base.component';
import { PoModalPasswordRecoveryModalContent } from './enums/po-modal-password-recovery-modal-content.enum';
import { PoModalPasswordRecoveryService } from './po-modal-password-recovery.service';
import { PoModalPasswordRecoveryType } from './enums/po-modal-password-recovery-type.enum';
/**
 * @docsExtends PoModalPasswordRecoveryBaseComponent
 *
 * @example
 *
 * <example name="po-modal-password-recovery-basic" title="PO Modal Password Recovery Basic">
 *  <file name="sample-po-modal-password-recovery-basic/sample-po-modal-password-recovery-basic.component.html"> </file>
 *  <file name="sample-po-modal-password-recovery-basic/sample-po-modal-password-recovery-basic.component.ts"> </file>
 * </example>
 *
 * <example name="po-modal-password-recovery-labs" title="PO Modal Password Recovery Labs">
 *  <file name="sample-po-modal-password-recovery-labs/sample-po-modal-password-recovery-labs.component.html"> </file>
 *  <file name="sample-po-modal-password-recovery-labs/sample-po-modal-password-recovery-labs.component.ts"> </file>
 * </example>
 *
 * <example name="po-modal-password-recovery-request" title="PO Modal Password Recovery Request">
 *  <file name="sample-po-modal-password-recovery-request/sample-po-modal-password-recovery-request.component.html"> </file>
 *  <file name="sample-po-modal-password-recovery-request/sample-po-modal-password-recovery-request.component.ts"> </file>
 * </example>
 */
var PoModalPasswordRecoveryComponent = /** @class */ (function (_super) {
    __extends(PoModalPasswordRecoveryComponent, _super);
    function PoModalPasswordRecoveryComponent(router, poI18nPipe, poModalPasswordRecoveryService) {
        var _this = _super.call(this) || this;
        _this.router = router;
        _this.poI18nPipe = poI18nPipe;
        _this.poModalPasswordRecoveryService = poModalPasswordRecoveryService;
        _this.chosenTypeFormOption = PoModalPasswordRecoveryType.Email;
        _this.codeMask = '9 9 9 9 9 9';
        _this.emailModal = true;
        _this.emailModalPhrases = { firstPhrase: null, secondPhrase: null };
        _this.endpoint = '.';
        _this.invalidCode = false;
        _this.invalidEmail = false;
        _this.modalType = PoModalPasswordRecoveryModalContent.Email;
        _this.submittedCodeValue = {};
        _this.submittedContactValue = {};
        _this.primaryAction = { label: undefined, action: function () { } };
        _this.secondaryAction = { label: undefined, action: function () { } };
        _this.typeFormOptions = [
            { label: 'e-mail', value: PoModalPasswordRecoveryType.Email },
            { label: 'SMS', value: PoModalPasswordRecoveryType.SMS }
        ];
        return _this;
    }
    PoModalPasswordRecoveryComponent.prototype.ngOnDestroy = function () {
        if (this.passwordRecoverySubscription) {
            this.passwordRecoverySubscription.unsubscribe();
        }
        if (this.smsCodeSubscription) {
            this.smsCodeSubscription.unsubscribe();
        }
    };
    PoModalPasswordRecoveryComponent.prototype.completed = function () {
        this.cancelAction();
    };
    PoModalPasswordRecoveryComponent.prototype.formModelChangesCheck = function (form) {
        var invalidForm = form.invalid;
        this.invalidEmail = invalidForm && form.dirty;
        this.primaryAction.disabled = invalidForm;
        if (this.modalType === PoModalPasswordRecoveryModalContent.SMSCode) {
            var codeError = this.codeError !== undefined && this.codeError !== '';
            this.showCustomCodeError = codeError && form.pristine;
        }
    };
    PoModalPasswordRecoveryComponent.prototype.getInputType = function (type) {
        var _this = this;
        this.type = type;
        this.pipeModalPhrases();
        setTimeout(function () {
            _this.control = _this.emailForm.controls[type];
            _this.formModelChangesCheck(_this.emailForm);
            _this.resetFormFields(_this.control);
        });
    };
    PoModalPasswordRecoveryComponent.prototype.open = function () {
        var control = this.checkFormType(this.type);
        this.control = this.emailForm.controls[control];
        this.setEmailModalPhrasesAndActions();
        this.formModelChangesCheck(this.emailForm);
        this.recoveryModalElement.open();
    };
    PoModalPasswordRecoveryComponent.prototype.openConfirmation = function () {
        this.modalTitle = this.literals.emailSentTitle;
        this.modalType = PoModalPasswordRecoveryModalContent.Confirmation;
        this.setActions(this.cancelAction, this.literals.closeButton, this.submitAction, this.literals.resendEmailButton, false);
    };
    PoModalPasswordRecoveryComponent.prototype.openSmsCode = function () {
        var _this = this;
        this.modalTitle = this.literals.typeCodeTitle;
        this.modalType = PoModalPasswordRecoveryModalContent.SMSCode;
        this.setActions(this.submitSmsCodeAction, this.literals.continueButton, this.cancelAction, this.literals.cancelButton, true);
        setTimeout(function () {
            _this.control = _this.smsCodeForm.controls['sms'];
            _this.formModelChangesCheck(_this.smsCodeForm);
        });
    };
    PoModalPasswordRecoveryComponent.prototype.resendSmsCode = function () {
        this.incrementRetryAttempts();
        if (this.urlRecovery) {
            this.submitActionRequest(this.submittedContactValue, this.type);
        }
        else {
            this.submit.emit(this.submittedContactValue);
        }
    };
    PoModalPasswordRecoveryComponent.prototype.assignSmsResponse = function (responseObj) {
        this.smsBodyResponse = Object.assign({}, { hash: responseObj.hash });
        if (responseObj.urlValidationCode) {
            this.smsBodyResponse = Object.assign(this.smsBodyResponse, { urlValidationCode: responseObj.urlValidationCode });
        }
    };
    PoModalPasswordRecoveryComponent.prototype.cancelAction = function () {
        this.resetFormFields(this.control);
        this.submittedContactValue = {};
        this.chosenTypeFormOption = PoModalPasswordRecoveryType.Email;
        this.modalType = PoModalPasswordRecoveryModalContent.Email;
        this.type = this.modalPasswordRecoveryTypeAll ? PoModalPasswordRecoveryType.All : this.type;
        this.recoveryModalElement.close();
    };
    PoModalPasswordRecoveryComponent.prototype.checkFormType = function (type) {
        return type !== PoModalPasswordRecoveryType.All ? type : PoModalPasswordRecoveryType.Email;
    };
    PoModalPasswordRecoveryComponent.prototype.formReset = function (control) {
        control.markAsPristine();
        control.markAsUntouched();
        control.updateValueAndValidity();
    };
    PoModalPasswordRecoveryComponent.prototype.getEmitValue = function (type) {
        return type === PoModalPasswordRecoveryType.SMS ? this.phone : this.email;
    };
    PoModalPasswordRecoveryComponent.prototype.incrementRetryAttempts = function () {
        this.submittedContactValue.retry = this.submittedContactValue.retry + 1 || 1;
    };
    PoModalPasswordRecoveryComponent.prototype.openExternalLink = function (url, queryParam) {
        window.open(url + "?token=" + queryParam, '_self');
    };
    PoModalPasswordRecoveryComponent.prototype.openInternalLink = function (url, endpoint, queryParam) {
        this.router.navigate([url + "/" + endpoint], { queryParams: { token: queryParam } });
    };
    PoModalPasswordRecoveryComponent.prototype.pipeModalPhrases = function () {
        if (this.type === PoModalPasswordRecoveryType.SMS) {
            this.emailModalPhrases.firstPhrase = this.setPipeArguments(this.literals.recoveryPasswordPhrase, this.literals.sms);
            this.emailModalPhrases.secondPhrase = this.setPipeArguments(this.literals.supportContact, this.literals.telephone);
        }
        else {
            this.emailModalPhrases.firstPhrase = this.setPipeArguments(this.literals.recoveryPasswordPhrase, this.literals.email);
            this.emailModalPhrases.secondPhrase = this.setPipeArguments(this.literals.supportContact, this.literals.email);
        }
    };
    PoModalPasswordRecoveryComponent.prototype.redirectToChangePassword = function (recoveryToken) {
        var urlChangePassword = recoveryToken.urlChangePassword;
        if (urlChangePassword) {
            isExternalLink(urlChangePassword)
                ? this.openExternalLink(urlChangePassword, recoveryToken.token)
                : this.openInternalLink(this.urlRecovery, urlChangePassword, recoveryToken.token);
        }
        else {
            var changePasswordEndpoint = 'changePassword';
            this.openInternalLink(this.urlRecovery, changePasswordEndpoint, recoveryToken.token);
        }
    };
    PoModalPasswordRecoveryComponent.prototype.resetFormFields = function (control) {
        this.formReset(control);
        this.email = undefined;
        this.phone = undefined;
        this.smsCode = undefined;
    };
    PoModalPasswordRecoveryComponent.prototype.setActions = function (primaryAction, primarylabel, secondaryAction, secondaryLabel, disabled) {
        var _this = this;
        this.primaryAction.action = function () { return primaryAction.call(_this); };
        this.primaryAction.label = primarylabel;
        this.secondaryAction.action = function () { return secondaryAction.call(_this); };
        this.secondaryAction.label = secondaryLabel;
        this.primaryAction.disabled = disabled;
    };
    PoModalPasswordRecoveryComponent.prototype.setEmailModalPhrasesAndActions = function () {
        this.modalTitle = this.literals.forgotPasswordTitle;
        this.pipeModalPhrases();
        this.modalPasswordRecoveryTypeAll = this.type === PoModalPasswordRecoveryType.All;
        this.setActions(this.submitAction, this.literals.sendButton, this.cancelAction, this.literals.cancelButton, true);
    };
    PoModalPasswordRecoveryComponent.prototype.setRequestEndpoint = function (urlValidationCode) {
        var endpoint = urlValidationCode || 'validation';
        return this.urlRecovery + "/" + endpoint;
    };
    PoModalPasswordRecoveryComponent.prototype.setPipeArguments = function (literalAttr, arg) {
        return this.poI18nPipe.transform(literalAttr, arg);
    };
    PoModalPasswordRecoveryComponent.prototype.submitAction = function () {
        this.modalType === PoModalPasswordRecoveryModalContent.Confirmation
            ? this.incrementRetryAttempts()
            : this.formReset(this.control);
        this.submittedContactValue[this.checkFormType(this.type)] = this.getEmitValue(this.type);
        if (this.urlRecovery) {
            this.submitActionRequest(this.submittedContactValue, this.type);
        }
        else {
            this.submit.emit(this.submittedContactValue);
        }
    };
    PoModalPasswordRecoveryComponent.prototype.submitActionRequest = function (data, modalType) {
        var _this = this;
        var params = modalType === PoModalPasswordRecoveryType.SMS ? { type: 'sms' } : undefined;
        this.passwordRecoverySubscription = this.poModalPasswordRecoveryService
            .post(this.urlRecovery, data, params)
            .subscribe(function (response) {
            if ((modalType === PoModalPasswordRecoveryType.Email || modalType === PoModalPasswordRecoveryType.All) &&
                response.status === 204) {
                _this.openConfirmation();
            }
            else if (modalType === PoModalPasswordRecoveryType.SMS && response.status === 200) {
                _this.assignSmsResponse(response.body);
                _this.openSmsCode();
            }
        });
    };
    PoModalPasswordRecoveryComponent.prototype.submitSmsCodeAction = function () {
        this.submittedCodeValue.code = this.smsCode;
        if (this.urlRecovery) {
            this.submittedCodeValue = Object.assign(this.submittedCodeValue, { hash: this.smsBodyResponse.hash });
            this.submitSmsCodeRequest(this.submittedCodeValue);
        }
        else {
            this.codeSubmit.emit(this.submittedCodeValue);
        }
        this.resetFormFields(this.control);
    };
    PoModalPasswordRecoveryComponent.prototype.submitSmsCodeRequest = function (data) {
        var _this = this;
        this.smsCodeSubscription = this.poModalPasswordRecoveryService
            .post(this.setRequestEndpoint(this.smsBodyResponse.urlValidationCode), data)
            .subscribe(function (response) {
            var successStatus = response.status === 200;
            if (successStatus) {
                _this.completed();
                _this.redirectToChangePassword(response.body);
            }
        }, function (error) {
            _this.codeError = error.error.message;
            _this.openSmsCode();
        });
    };
    PoModalPasswordRecoveryComponent.ctorParameters = function () { return [
        { type: Router },
        { type: PoI18nPipe },
        { type: PoModalPasswordRecoveryService }
    ]; };
    __decorate([
        ViewChild('emailForm'),
        __metadata("design:type", NgForm)
    ], PoModalPasswordRecoveryComponent.prototype, "emailForm", void 0);
    __decorate([
        ViewChild('recoveryModal', { static: true }),
        __metadata("design:type", PoModalComponent)
    ], PoModalPasswordRecoveryComponent.prototype, "recoveryModalElement", void 0);
    __decorate([
        ViewChild('smsCodeForm'),
        __metadata("design:type", NgForm)
    ], PoModalPasswordRecoveryComponent.prototype, "smsCodeForm", void 0);
    PoModalPasswordRecoveryComponent = __decorate([
        Component({
            selector: 'po-modal-password-recovery',
            template: "<po-modal\n  #recoveryModal\n  p-hide-close\n  p-size=\"auto\"\n  [ngSwitch]=\"modalType\"\n  [p-primary-action]=\"primaryAction\"\n  [p-secondary-action]=\"secondaryAction\"\n  [p-title]=\"modalTitle\"\n>\n  <div class=\"po-modal-password-recovery-wrapper\">\n    <div *ngSwitchCase=\"'email'\" class=\"po-modal-password-recovery-content po-row\">\n      <div class=\"po-modal-password-recovery-text po-md-12 po-mb-1\">\n        {{ emailModalPhrases.firstPhrase }}\n      </div>\n      <div class=\"po-mb-2 po-md-12\">\n        <form #emailForm=\"ngForm\">\n          <div *ngIf=\"modalPasswordRecoveryTypeAll\">\n            <po-radio-group\n              name=\"type\"\n              [(ngModel)]=\"chosenTypeFormOption\"\n              [p-options]=\"typeFormOptions\"\n              (p-change)=\"getInputType($event)\"\n            >\n            </po-radio-group>\n          </div>\n\n          <div class=\"po-mt-1\">\n            <po-email\n              *ngIf=\"type === 'email' || type === 'all'\"\n              name=\"email\"\n              [(ngModel)]=\"email\"\n              p-required\n              [p-label]=\"literals.insertEmail\"\n              (p-change-model)=\"formModelChangesCheck(emailForm)\"\n            >\n            </po-email>\n\n            <po-input\n              *ngIf=\"type === 'sms'\"\n              name=\"sms\"\n              [(ngModel)]=\"phone\"\n              p-icon=\"po-icon-telephone\"\n              p-required\n              [p-label]=\"literals.insertPhone\"\n              [p-mask]=\"phoneMask\"\n              [p-maxlength]=\"maxLength\"\n              [p-minlength]=\"minLength\"\n              (p-change-model)=\"formModelChangesCheck(emailForm)\"\n            >\n            </po-input>\n          </div>\n\n          <div class=\"po-field-container-bottom po-field-container-error-container\">\n            <po-modal-password-recovery-error-message\n              *ngIf=\"invalidEmail && control.dirty\"\n              [p-text]=\"type === 'sms' ? literals.phoneErrorMessagePhrase : literals.emailErrorMessagePhrase\"\n            >\n            </po-modal-password-recovery-error-message>\n          </div>\n        </form>\n      </div>\n      <div class=\"po-modal-password-recovery-text po-md-12\">\n        {{ emailModalPhrases.secondPhrase }}\n        <span *ngIf=\"contactEmail\">\n          {{ literals.prepositionIn }}\n          <a class=\"po-modal-password-recovery-link\" href=\"mailto:{{ contactEmail }}\" target=\"_self\">\n            {{ contactEmail }}\n          </a>\n        </span>\n        {{ endpoint }}\n      </div>\n    </div>\n\n    <div #smsCodeModal *ngSwitchCase=\"'smsCode'\" class=\"po-modal-password-recovery-content po-row\">\n      <div class=\"po-modal-password-recovery-text po-md-12 po-mb-1\">{{ literals.sentSmsCodePhrase }}</div>\n      <div class=\"po-mb-2 po-md-12\">\n        <form #smsCodeForm=\"ngForm\">\n          <po-input\n            name=\"sms\"\n            [(ngModel)]=\"smsCode\"\n            p-maxlength=\"11\"\n            p-minlength=\"11\"\n            p-required\n            [p-label]=\"literals.insertCode\"\n            [p-mask]=\"codeMask\"\n            (p-change-model)=\"formModelChangesCheck(smsCodeForm)\"\n          >\n          </po-input>\n          <div class=\"po-field-container-bottom po-field-container-error-container\">\n            <po-modal-password-recovery-error-message\n              *ngIf=\"invalidEmail\"\n              [p-text]=\"smsCodeErrorMessage || this.literals.smsCodeErrorMessagePhrase\"\n            >\n            </po-modal-password-recovery-error-message>\n            <po-modal-password-recovery-error-message *ngIf=\"showCustomCodeError\" [p-text]=\"codeError\">\n            </po-modal-password-recovery-error-message>\n          </div>\n        </form>\n      </div>\n      <div class=\"po-modal-password-recovery-text po-md-12\">\n        {{ literals.sendAgainPhrase }}\n        <span class=\"po-modal-password-recovery-link\" (click)=\"resendSmsCode()\">{{ literals.sendAgain }}</span>\n      </div>\n    </div>\n\n    <div #confirmationModal *ngSwitchCase=\"'confirmation'\" class=\"po-modal-password-recovery-content po-row\">\n      <img class=\"po-modal-password-recovery-user-image po-mb-2\" src=\"./assets/images/email-sent.svg\" />\n      <div class=\"po-modal-password-recovery-text\">\n        {{ literals.emailSentConfirmationPhrase }}\n      </div>\n    </div>\n  </div>\n</po-modal>\n"
        }),
        __metadata("design:paramtypes", [Router,
            PoI18nPipe,
            PoModalPasswordRecoveryService])
    ], PoModalPasswordRecoveryComponent);
    return PoModalPasswordRecoveryComponent;
}(PoModalPasswordRecoveryBaseComponent));
export { PoModalPasswordRecoveryComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnkuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHBvLXVpL25nLXRlbXBsYXRlcy8iLCJzb3VyY2VzIjpbImxpYi9jb21wb25lbnRzL3BvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5L3BvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBYSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDaEUsT0FBTyxFQUFtQixNQUFNLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN6RCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFHekMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixFQUFFLGtCQUFrQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFHdkcsT0FBTyxFQUFFLG9DQUFvQyxFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFDbkcsT0FBTyxFQUFFLG1DQUFtQyxFQUFFLE1BQU0sdURBQXVELENBQUM7QUFDNUcsT0FBTyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sc0NBQXNDLENBQUM7QUFDdEYsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFFM0Y7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0FtQkc7QUFNSDtJQUFzRCxvREFBb0M7SUFtQ3hGLDBDQUNVLE1BQWMsRUFDZCxVQUFzQixFQUN0Qiw4QkFBOEQ7UUFIeEUsWUFLRSxpQkFBTyxTQUNSO1FBTFMsWUFBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLGdCQUFVLEdBQVYsVUFBVSxDQUFZO1FBQ3RCLG9DQUE4QixHQUE5Qiw4QkFBOEIsQ0FBZ0M7UUFyQ3hFLDBCQUFvQixHQUFXLDJCQUEyQixDQUFDLEtBQUssQ0FBQztRQUNq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cG9ydCB7IENvbXBvbmVudCwgT25EZXN0cm95LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgTmdGb3JtIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBpc0V4dGVybmFsTGluayB9IGZyb20gJy4uLy4uL3V0aWxzL3V0aWwnO1xuaW1wb3J0IHsgUG9JMThuUGlwZSwgUG9Nb2RhbEFjdGlvbiwgUG9Nb2RhbENvbXBvbmVudCwgUG9SYWRpb0dyb3VwT3B0aW9uIH0gZnJvbSAnQHBvLXVpL25nLWNvbXBvbmVudHMnO1xuXG5pbXBvcnQgeyBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeSB9IGZyb20gJy4vaW50ZXJmYWNlcy9wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlCYXNlQ29tcG9uZW50IH0gZnJvbSAnLi9wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1iYXNlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeU1vZGFsQ29udGVudCB9IGZyb20gJy4vZW51bXMvcG8tbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktbW9kYWwtY29udGVudC5lbnVtJztcbmltcG9ydCB7IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5U2VydmljZSB9IGZyb20gJy4vcG8tbW9kYWwtcGFzc3dvcmQtcmVjb3Zlcnkuc2VydmljZSc7XG5pbXBvcnQgeyBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUgfSBmcm9tICcuL2VudW1zL3BvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LXR5cGUuZW51bSc7XG5cbi8qKlxuICogQGRvY3NFeHRlbmRzIFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5QmFzZUNvbXBvbmVudFxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogPGV4YW1wbGUgbmFtZT1cInBvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWJhc2ljXCIgdGl0bGU9XCJQTyBNb2RhbCBQYXNzd29yZCBSZWNvdmVyeSBCYXNpY1wiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktYmFzaWMvc2FtcGxlLXBvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWJhc2ljLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWJhc2ljL3NhbXBsZS1wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1iYXNpYy5jb21wb25lbnQudHNcIj4gPC9maWxlPlxuICogPC9leGFtcGxlPlxuICpcbiAqIDxleGFtcGxlIG5hbWU9XCJwby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1sYWJzXCIgdGl0bGU9XCJQTyBNb2RhbCBQYXNzd29yZCBSZWNvdmVyeSBMYWJzXCI+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1sYWJzL3NhbXBsZS1wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1sYWJzLmNvbXBvbmVudC5odG1sXCI+IDwvZmlsZT5cbiAqICA8ZmlsZSBuYW1lPVwic2FtcGxlLXBvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWxhYnMvc2FtcGxlLXBvLW1vZGFsLXBhc3N3b3JkLXJlY292ZXJ5LWxhYnMuY29tcG9uZW50LnRzXCI+IDwvZmlsZT5cbiAqIDwvZXhhbXBsZT5cbiAqXG4gKiA8ZXhhbXBsZSBuYW1lPVwicG8tbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktcmVxdWVzdFwiIHRpdGxlPVwiUE8gTW9kYWwgUGFzc3dvcmQgUmVjb3ZlcnkgUmVxdWVzdFwiPlxuICogIDxmaWxlIG5hbWU9XCJzYW1wbGUtcG8tbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktcmVxdWVzdC9zYW1wbGUtcG8tbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnktcmVxdWVzdC5jb21wb25lbnQuaHRtbFwiPiA8L2ZpbGU+XG4gKiAgPGZpbGUgbmFtZT1cInNhbXBsZS1wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1yZXF1ZXN0L3NhbXBsZS1wby1tb2RhbC1wYXNzd29yZC1yZWNvdmVyeS1yZXF1ZXN0LmNvbXBvbmVudC50c1wiPiA8L2ZpbGU+XG4gKiA8L2V4YW1wbGU+XG4gKi9cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAncG8tbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnknLFxuICB0ZW1wbGF0ZVVybDogJy4vcG8tbW9kYWwtcGFzc3dvcmQtcmVjb3ZlcnkuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5Q29tcG9uZW50IGV4dGVuZHMgUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlCYXNlQ29tcG9uZW50IGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgY2hvc2VuVHlwZUZvcm1PcHRpb246IHN0cmluZyA9IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5FbWFpbDtcbiAgY29kZU1hc2s6IHN0cmluZyA9ICc5IDkgOSA5IDkgOSc7XG4gIGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbDtcbiAgZW1haWxNb2RhbDogYm9vbGVhbiA9IHRydWU7XG4gIGVtYWlsTW9kYWxQaHJhc2VzID0geyBmaXJzdFBocmFzZTogbnVsbCBhcyBzdHJpbmcsIHNlY29uZFBocmFzZTogbnVsbCBhcyBzdHJpbmcgfTtcbiAgZW5kcG9pbnQ6IHN0cmluZyA9ICcuJztcbiAgaW52YWxpZENvZGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgaW52YWxpZEVtYWlsOiBib29sZWFuID0gZmFsc2U7XG4gIG1vZGFsVGl0bGU6IHN0cmluZztcbiAgbW9kYWxUeXBlOiBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeU1vZGFsQ29udGVudCA9IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5TW9kYWxDb250ZW50LkVtYWlsO1xuICBzaG93Q3VzdG9tQ29kZUVycm9yOiBib29sZWFuO1xuICBzbXNDb2RlRXJyb3JNZXNzYWdlUGhyYXNlOiBzdHJpbmc7XG4gIHN1Ym1pdHRlZENvZGVWYWx1ZSA9IHt9IGFzIFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5O1xuICBzdWJtaXR0ZWRDb250YWN0VmFsdWUgPSB7fSBhcyBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeTtcblxuICBwcml2YXRlIHBhc3N3b3JkUmVjb3ZlcnlTdWJzY3JpcHRpb246IFN1YnNjcmlwdGlvbjtcbiAgcHJpdmF0ZSBzbXNCb2R5UmVzcG9uc2U7XG4gIHByaXZhdGUgc21zQ29kZVN1YnNjcmlwdGlvbjogU3Vic2NyaXB0aW9uO1xuXG4gIEBWaWV3Q2hpbGQoJ2VtYWlsRm9ybScpIGVtYWlsRm9ybTogTmdGb3JtO1xuXG4gIEBWaWV3Q2hpbGQoJ3JlY292ZXJ5TW9kYWwnLCB7IHN0YXRpYzogdHJ1ZSB9KSByZWNvdmVyeU1vZGFsRWxlbWVudDogUG9Nb2RhbENvbXBvbmVudDtcblxuICBAVmlld0NoaWxkKCdzbXNDb2RlRm9ybScpIHNtc0NvZGVGb3JtOiBOZ0Zvcm07XG5cbiAgcHJpbWFyeUFjdGlvbjogUG9Nb2RhbEFjdGlvbiA9IHsgbGFiZWw6IHVuZGVmaW5lZCwgYWN0aW9uOiAoKSA9PiB7fSB9O1xuXG4gIHNlY29uZGFyeUFjdGlvbjogUG9Nb2RhbEFjdGlvbiA9IHsgbGFiZWw6IHVuZGVmaW5lZCwgYWN0aW9uOiAoKSA9PiB7fSB9O1xuXG4gIHR5cGVGb3JtT3B0aW9uczogQXJyYXk8UG9SYWRpb0dyb3VwT3B0aW9uPiA9IFtcbiAgICB7IGxhYmVsOiAnZS1tYWlsJywgdmFsdWU6IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5FbWFpbCB9LFxuICAgIHsgbGFiZWw6ICdTTVMnLCB2YWx1ZTogUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLlNNUyB9XG4gIF07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIHBvSTE4blBpcGU6IFBvSTE4blBpcGUsXG4gICAgcHJpdmF0ZSBwb01vZGFsUGFzc3dvcmRSZWNvdmVyeVNlcnZpY2U6IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5U2VydmljZVxuICApIHtcbiAgICBzdXBlcigpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMucGFzc3dvcmRSZWNvdmVyeVN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5wYXNzd29yZFJlY292ZXJ5U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc21zQ29kZVN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zbXNDb2RlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgY29tcGxldGVkKCkge1xuICAgIHRoaXMuY2FuY2VsQWN0aW9uKCk7XG4gIH1cblxuICBmb3JtTW9kZWxDaGFuZ2VzQ2hlY2soZm9ybTogTmdGb3JtKSB7XG4gICAgY29uc3QgaW52YWxpZEZvcm0gPSBmb3JtLmludmFsaWQ7XG4gICAgdGhpcy5pbnZhbGlkRW1haWwgPSBpbnZhbGlkRm9ybSAmJiBmb3JtLmRpcnR5O1xuICAgIHRoaXMucHJpbWFyeUFjdGlvbi5kaXNhYmxlZCA9IGludmFsaWRGb3JtO1xuXG4gICAgaWYgKHRoaXMubW9kYWxUeXBlID09PSBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeU1vZGFsQ29udGVudC5TTVNDb2RlKSB7XG4gICAgICBjb25zdCBjb2RlRXJyb3I6IGJvb2xlYW4gPSB0aGlzLmNvZGVFcnJvciAhPT0gdW5kZWZpbmVkICYmIHRoaXMuY29kZUVycm9yICE9PSAnJztcbiAgICAgIHRoaXMuc2hvd0N1c3RvbUNvZGVFcnJvciA9IGNvZGVFcnJvciAmJiBmb3JtLnByaXN0aW5lO1xuICAgIH1cbiAgfVxuXG4gIGdldElucHV0VHlwZSh0eXBlKSB7XG4gICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICB0aGlzLnBpcGVNb2RhbFBocmFzZXMoKTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuY29udHJvbCA9IHRoaXMuZW1haWxGb3JtLmNvbnRyb2xzW3R5cGVdO1xuICAgICAgdGhpcy5mb3JtTW9kZWxDaGFuZ2VzQ2hlY2sodGhpcy5lbWFpbEZvcm0pO1xuICAgICAgdGhpcy5yZXNldEZvcm1GaWVsZHModGhpcy5jb250cm9sKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgY29uc3QgY29udHJvbCA9IHRoaXMuY2hlY2tGb3JtVHlwZSh0aGlzLnR5cGUpO1xuICAgIHRoaXMuY29udHJvbCA9IHRoaXMuZW1haWxGb3JtLmNvbnRyb2xzW2NvbnRyb2xdO1xuICAgIHRoaXMuc2V0RW1haWxNb2RhbFBocmFzZXNBbmRBY3Rpb25zKCk7XG4gICAgdGhpcy5mb3JtTW9kZWxDaGFuZ2VzQ2hlY2sodGhpcy5lbWFpbEZvcm0pO1xuICAgIHRoaXMucmVjb3ZlcnlNb2RhbEVsZW1lbnQub3BlbigpO1xuICB9XG5cbiAgb3BlbkNvbmZpcm1hdGlvbigpIHtcbiAgICB0aGlzLm1vZGFsVGl0bGUgPSB0aGlzLmxpdGVyYWxzLmVtYWlsU2VudFRpdGxlO1xuICAgIHRoaXMubW9kYWxUeXBlID0gUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlNb2RhbENvbnRlbnQuQ29uZmlybWF0aW9uO1xuICAgIHRoaXMuc2V0QWN0aW9ucyhcbiAgICAgIHRoaXMuY2FuY2VsQWN0aW9uLFxuICAgICAgdGhpcy5saXRlcmFscy5jbG9zZUJ1dHRvbixcbiAgICAgIHRoaXMuc3VibWl0QWN0aW9uLFxuICAgICAgdGhpcy5saXRlcmFscy5yZXNlbmRFbWFpbEJ1dHRvbixcbiAgICAgIGZhbHNlXG4gICAgKTtcbiAgfVxuXG4gIG9wZW5TbXNDb2RlKCkge1xuICAgIHRoaXMubW9kYWxUaXRsZSA9IHRoaXMubGl0ZXJhbHMudHlwZUNvZGVUaXRsZTtcbiAgICB0aGlzLm1vZGFsVHlwZSA9IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5TW9kYWxDb250ZW50LlNNU0NvZGU7XG4gICAgdGhpcy5zZXRBY3Rpb25zKFxuICAgICAgdGhpcy5zdWJtaXRTbXNDb2RlQWN0aW9uLFxuICAgICAgdGhpcy5saXRlcmFscy5jb250aW51ZUJ1dHRvbixcbiAgICAgIHRoaXMuY2FuY2VsQWN0aW9uLFxuICAgICAgdGhpcy5saXRlcmFscy5jYW5jZWxCdXR0b24sXG4gICAgICB0cnVlXG4gICAgKTtcblxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5jb250cm9sID0gdGhpcy5zbXNDb2RlRm9ybS5jb250cm9sc1snc21zJ107XG4gICAgICB0aGlzLmZvcm1Nb2RlbENoYW5nZXNDaGVjayh0aGlzLnNtc0NvZGVGb3JtKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlc2VuZFNtc0NvZGUoKSB7XG4gICAgdGhpcy5pbmNyZW1lbnRSZXRyeUF0dGVtcHRzKCk7XG4gICAgaWYgKHRoaXMudXJsUmVjb3ZlcnkpIHtcbiAgICAgIHRoaXMuc3VibWl0QWN0aW9uUmVxdWVzdCh0aGlzLnN1Ym1pdHRlZENvbnRhY3RWYWx1ZSwgdGhpcy50eXBlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdWJtaXQuZW1pdCh0aGlzLnN1Ym1pdHRlZENvbnRhY3RWYWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3NpZ25TbXNSZXNwb25zZShyZXNwb25zZU9iaikge1xuICAgIHRoaXMuc21zQm9keVJlc3BvbnNlID0gT2JqZWN0LmFzc2lnbih7fSwgeyBoYXNoOiByZXNwb25zZU9iai5oYXNoIH0pO1xuICAgIGlmIChyZXNwb25zZU9iai51cmxWYWxpZGF0aW9uQ29kZSkge1xuICAgICAgdGhpcy5zbXNCb2R5UmVzcG9uc2UgPSBPYmplY3QuYXNzaWduKHRoaXMuc21zQm9keVJlc3BvbnNlLCB7IHVybFZhbGlkYXRpb25Db2RlOiByZXNwb25zZU9iai51cmxWYWxpZGF0aW9uQ29kZSB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNhbmNlbEFjdGlvbigpIHtcbiAgICB0aGlzLnJlc2V0Rm9ybUZpZWxkcyh0aGlzLmNvbnRyb2wpO1xuICAgIHRoaXMuc3VibWl0dGVkQ29udGFjdFZhbHVlID0ge307XG5cbiAgICB0aGlzLmNob3NlblR5cGVGb3JtT3B0aW9uID0gUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLkVtYWlsO1xuICAgIHRoaXMubW9kYWxUeXBlID0gUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlNb2RhbENvbnRlbnQuRW1haWw7XG4gICAgdGhpcy50eXBlID0gdGhpcy5tb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlQWxsID8gUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLkFsbCA6IHRoaXMudHlwZTtcbiAgICB0aGlzLnJlY292ZXJ5TW9kYWxFbGVtZW50LmNsb3NlKCk7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrRm9ybVR5cGUodHlwZTogUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlKSB7XG4gICAgcmV0dXJuIHR5cGUgIT09IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5BbGwgPyB0eXBlIDogUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLkVtYWlsO1xuICB9XG5cbiAgcHJpdmF0ZSBmb3JtUmVzZXQoY29udHJvbDogQWJzdHJhY3RDb250cm9sKSB7XG4gICAgY29udHJvbC5tYXJrQXNQcmlzdGluZSgpO1xuICAgIGNvbnRyb2wubWFya0FzVW50b3VjaGVkKCk7XG4gICAgY29udHJvbC51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XG4gIH1cblxuICBwcml2YXRlIGdldEVtaXRWYWx1ZSh0eXBlOiBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUpIHtcbiAgICByZXR1cm4gdHlwZSA9PT0gUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLlNNUyA/IHRoaXMucGhvbmUgOiB0aGlzLmVtYWlsO1xuICB9XG5cbiAgcHJpdmF0ZSBpbmNyZW1lbnRSZXRyeUF0dGVtcHRzKCkge1xuICAgIHRoaXMuc3VibWl0dGVkQ29udGFjdFZhbHVlLnJldHJ5ID0gdGhpcy5zdWJtaXR0ZWRDb250YWN0VmFsdWUucmV0cnkgKyAxIHx8IDE7XG4gIH1cblxuICBwcml2YXRlIG9wZW5FeHRlcm5hbExpbmsodXJsLCBxdWVyeVBhcmFtKSB7XG4gICAgd2luZG93Lm9wZW4oYCR7dXJsfT90b2tlbj0ke3F1ZXJ5UGFyYW19YCwgJ19zZWxmJyk7XG4gIH1cblxuICBwcml2YXRlIG9wZW5JbnRlcm5hbExpbmsodXJsLCBlbmRwb2ludCwgcXVlcnlQYXJhbSkge1xuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFtgJHt1cmx9LyR7ZW5kcG9pbnR9YF0sIHsgcXVlcnlQYXJhbXM6IHsgdG9rZW46IHF1ZXJ5UGFyYW0gfSB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcGlwZU1vZGFsUGhyYXNlcygpIHtcbiAgICBpZiAodGhpcy50eXBlID09PSBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUuU01TKSB7XG4gICAgICB0aGlzLmVtYWlsTW9kYWxQaHJhc2VzLmZpcnN0UGhyYXNlID0gdGhpcy5zZXRQaXBlQXJndW1lbnRzKFxuICAgICAgICB0aGlzLmxpdGVyYWxzLnJlY292ZXJ5UGFzc3dvcmRQaHJhc2UsXG4gICAgICAgIHRoaXMubGl0ZXJhbHMuc21zXG4gICAgICApO1xuICAgICAgdGhpcy5lbWFpbE1vZGFsUGhyYXNlcy5zZWNvbmRQaHJhc2UgPSB0aGlzLnNldFBpcGVBcmd1bWVudHMoXG4gICAgICAgIHRoaXMubGl0ZXJhbHMuc3VwcG9ydENvbnRhY3QsXG4gICAgICAgIHRoaXMubGl0ZXJhbHMudGVsZXBob25lXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmVtYWlsTW9kYWxQaHJhc2VzLmZpcnN0UGhyYXNlID0gdGhpcy5zZXRQaXBlQXJndW1lbnRzKFxuICAgICAgICB0aGlzLmxpdGVyYWxzLnJlY292ZXJ5UGFzc3dvcmRQaHJhc2UsXG4gICAgICAgIHRoaXMubGl0ZXJhbHMuZW1haWxcbiAgICAgICk7XG4gICAgICB0aGlzLmVtYWlsTW9kYWxQaHJhc2VzLnNlY29uZFBocmFzZSA9IHRoaXMuc2V0UGlwZUFyZ3VtZW50cyh0aGlzLmxpdGVyYWxzLnN1cHBvcnRDb250YWN0LCB0aGlzLmxpdGVyYWxzLmVtYWlsKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlZGlyZWN0VG9DaGFuZ2VQYXNzd29yZChyZWNvdmVyeVRva2VuOiBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeSkge1xuICAgIGNvbnN0IHVybENoYW5nZVBhc3N3b3JkID0gcmVjb3ZlcnlUb2tlbi51cmxDaGFuZ2VQYXNzd29yZDtcbiAgICBpZiAodXJsQ2hhbmdlUGFzc3dvcmQpIHtcbiAgICAgIGlzRXh0ZXJuYWxMaW5rKHVybENoYW5nZVBhc3N3b3JkKVxuICAgICAgICA/IHRoaXMub3BlbkV4dGVybmFsTGluayh1cmxDaGFuZ2VQYXNzd29yZCwgcmVjb3ZlcnlUb2tlbi50b2tlbilcbiAgICAgICAgOiB0aGlzLm9wZW5JbnRlcm5hbExpbmsodGhpcy51cmxSZWNvdmVyeSwgdXJsQ2hhbmdlUGFzc3dvcmQsIHJlY292ZXJ5VG9rZW4udG9rZW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBjaGFuZ2VQYXNzd29yZEVuZHBvaW50ID0gJ2NoYW5nZVBhc3N3b3JkJztcbiAgICAgIHRoaXMub3BlbkludGVybmFsTGluayh0aGlzLnVybFJlY292ZXJ5LCBjaGFuZ2VQYXNzd29yZEVuZHBvaW50LCByZWNvdmVyeVRva2VuLnRva2VuKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHJlc2V0Rm9ybUZpZWxkcyhjb250cm9sKSB7XG4gICAgdGhpcy5mb3JtUmVzZXQoY29udHJvbCk7XG4gICAgdGhpcy5lbWFpbCA9IHVuZGVmaW5lZDtcbiAgICB0aGlzLnBob25lID0gdW5kZWZpbmVkO1xuICAgIHRoaXMuc21zQ29kZSA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgc2V0QWN0aW9ucyhwcmltYXJ5QWN0aW9uLCBwcmltYXJ5bGFiZWwsIHNlY29uZGFyeUFjdGlvbiwgc2Vjb25kYXJ5TGFiZWwsIGRpc2FibGVkKSB7XG4gICAgdGhpcy5wcmltYXJ5QWN0aW9uLmFjdGlvbiA9ICgpID0+IHByaW1hcnlBY3Rpb24uY2FsbCh0aGlzKTtcbiAgICB0aGlzLnByaW1hcnlBY3Rpb24ubGFiZWwgPSBwcmltYXJ5bGFiZWw7XG4gICAgdGhpcy5zZWNvbmRhcnlBY3Rpb24uYWN0aW9uID0gKCkgPT4gc2Vjb25kYXJ5QWN0aW9uLmNhbGwodGhpcyk7XG4gICAgdGhpcy5zZWNvbmRhcnlBY3Rpb24ubGFiZWwgPSBzZWNvbmRhcnlMYWJlbDtcbiAgICB0aGlzLnByaW1hcnlBY3Rpb24uZGlzYWJsZWQgPSBkaXNhYmxlZDtcbiAgfVxuXG4gIHByaXZhdGUgc2V0RW1haWxNb2RhbFBocmFzZXNBbmRBY3Rpb25zKCkge1xuICAgIHRoaXMubW9kYWxUaXRsZSA9IHRoaXMubGl0ZXJhbHMuZm9yZ290UGFzc3dvcmRUaXRsZTtcbiAgICB0aGlzLnBpcGVNb2RhbFBocmFzZXMoKTtcbiAgICB0aGlzLm1vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGVBbGwgPSB0aGlzLnR5cGUgPT09IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5BbGw7XG4gICAgdGhpcy5zZXRBY3Rpb25zKHRoaXMuc3VibWl0QWN0aW9uLCB0aGlzLmxpdGVyYWxzLnNlbmRCdXR0b24sIHRoaXMuY2FuY2VsQWN0aW9uLCB0aGlzLmxpdGVyYWxzLmNhbmNlbEJ1dHRvbiwgdHJ1ZSk7XG4gIH1cblxuICBwcml2YXRlIHNldFJlcXVlc3RFbmRwb2ludCh1cmxWYWxpZGF0aW9uQ29kZT86IHN0cmluZykge1xuICAgIGNvbnN0IGVuZHBvaW50ID0gdXJsVmFsaWRhdGlvbkNvZGUgfHwgJ3ZhbGlkYXRpb24nO1xuXG4gICAgcmV0dXJuIGAke3RoaXMudXJsUmVjb3Zlcnl9LyR7ZW5kcG9pbnR9YDtcbiAgfVxuXG4gIHByaXZhdGUgc2V0UGlwZUFyZ3VtZW50cyhsaXRlcmFsQXR0cjogc3RyaW5nLCBhcmc6IHN0cmluZykge1xuICAgIHJldHVybiB0aGlzLnBvSTE4blBpcGUudHJhbnNmb3JtKGxpdGVyYWxBdHRyLCBhcmcpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdWJtaXRBY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RhbFR5cGUgPT09IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5TW9kYWxDb250ZW50LkNvbmZpcm1hdGlvblxuICAgICAgPyB0aGlzLmluY3JlbWVudFJldHJ5QXR0ZW1wdHMoKVxuICAgICAgOiB0aGlzLmZvcm1SZXNldCh0aGlzLmNvbnRyb2wpO1xuICAgIHRoaXMuc3VibWl0dGVkQ29udGFjdFZhbHVlW3RoaXMuY2hlY2tGb3JtVHlwZSh0aGlzLnR5cGUpXSA9IHRoaXMuZ2V0RW1pdFZhbHVlKHRoaXMudHlwZSk7XG4gICAgaWYgKHRoaXMudXJsUmVjb3ZlcnkpIHtcbiAgICAgIHRoaXMuc3VibWl0QWN0aW9uUmVxdWVzdCh0aGlzLnN1Ym1pdHRlZENvbnRhY3RWYWx1ZSwgdGhpcy50eXBlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdWJtaXQuZW1pdCh0aGlzLnN1Ym1pdHRlZENvbnRhY3RWYWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzdWJtaXRBY3Rpb25SZXF1ZXN0KGRhdGE6IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5LCBtb2RhbFR5cGU6IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZSkge1xuICAgIGNvbnN0IHBhcmFtcyA9IG1vZGFsVHlwZSA9PT0gUG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlUeXBlLlNNUyA/IHsgdHlwZTogJ3NtcycgfSA6IHVuZGVmaW5lZDtcblxuICAgIHRoaXMucGFzc3dvcmRSZWNvdmVyeVN1YnNjcmlwdGlvbiA9IHRoaXMucG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlTZXJ2aWNlXG4gICAgICAucG9zdCh0aGlzLnVybFJlY292ZXJ5LCBkYXRhLCBwYXJhbXMpXG4gICAgICAuc3Vic2NyaWJlKHJlc3BvbnNlID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIChtb2RhbFR5cGUgPT09IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5FbWFpbCB8fCBtb2RhbFR5cGUgPT09IFBvTW9kYWxQYXNzd29yZFJlY292ZXJ5VHlwZS5BbGwpICYmXG4gICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzID09PSAyMDRcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5vcGVuQ29uZmlybWF0aW9uKCk7XG4gICAgICAgIH0gZWxzZSBpZiAobW9kYWxUeXBlID09PSBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeVR5cGUuU01TICYmIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgdGhpcy5hc3NpZ25TbXNSZXNwb25zZShyZXNwb25zZS5ib2R5KTtcbiAgICAgICAgICB0aGlzLm9wZW5TbXNDb2RlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBzdWJtaXRTbXNDb2RlQWN0aW9uKCkge1xuICAgIHRoaXMuc3VibWl0dGVkQ29kZVZhbHVlLmNvZGUgPSB0aGlzLnNtc0NvZGU7XG5cbiAgICBpZiAodGhpcy51cmxSZWNvdmVyeSkge1xuICAgICAgdGhpcy5zdWJtaXR0ZWRDb2RlVmFsdWUgPSBPYmplY3QuYXNzaWduKHRoaXMuc3VibWl0dGVkQ29kZVZhbHVlLCB7IGhhc2g6IHRoaXMuc21zQm9keVJlc3BvbnNlLmhhc2ggfSk7XG4gICAgICB0aGlzLnN1Ym1pdFNtc0NvZGVSZXF1ZXN0KHRoaXMuc3VibWl0dGVkQ29kZVZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb2RlU3VibWl0LmVtaXQodGhpcy5zdWJtaXR0ZWRDb2RlVmFsdWUpO1xuICAgIH1cbiAgICB0aGlzLnJlc2V0Rm9ybUZpZWxkcyh0aGlzLmNvbnRyb2wpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdWJtaXRTbXNDb2RlUmVxdWVzdChkYXRhOiBQb01vZGFsUGFzc3dvcmRSZWNvdmVyeSkge1xuICAgIHRoaXMuc21zQ29kZVN1YnNjcmlwdGlvbiA9IHRoaXMucG9Nb2RhbFBhc3N3b3JkUmVjb3ZlcnlTZXJ2aWNlXG4gICAgICAucG9zdCh0aGlzLnNldFJlcXVlc3RFbmRwb2ludCh0aGlzLnNtc0JvZHlSZXNwb25zZS51cmxWYWxpZGF0aW9uQ29kZSksIGRhdGEpXG4gICAgICAuc3Vic2NyaWJlKFxuICAgICAgICByZXNwb25zZSA9PiB7XG4gICAgICAgICAgY29uc3Qgc3VjY2Vzc1N0YXR1cyA9IHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwO1xuICAgICAgICAgIGlmIChzdWNjZXNzU3RhdHVzKSB7XG4gICAgICAgICAgICB0aGlzLmNvbXBsZXRlZCgpO1xuICAgICAgICAgICAgdGhpcy5yZWRpcmVjdFRvQ2hhbmdlUGFzc3dvcmQocmVzcG9uc2UuYm9keSk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgdGhpcy5jb2RlRXJyb3IgPSBlcnJvci5lcnJvci5tZXNzYWdlO1xuICAgICAgICAgIHRoaXMub3BlblNtc0NvZGUoKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgfVxufVxuIl19