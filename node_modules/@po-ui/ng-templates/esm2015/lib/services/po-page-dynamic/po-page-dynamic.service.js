import { __decorate, __metadata } from "tslib";
import { Injectable } from '@angular/core';
import { HttpClient, HttpErrorResponse, HttpHeaders, HttpParams } from '@angular/common/http';
import { merge, of, throwError } from 'rxjs';
import { map, catchError } from 'rxjs/operators';
import { PoLanguageService, PoNotificationService } from '@po-ui/ng-components';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
import * as i2 from "@po-ui/ng-components";
export const poPageDynamicLiterals = {
    en: {
        errorRenderPage: 'Error loading page',
        notPossibleLoadMetadataPage: 'The page metadata could not be loaded'
    },
    es: {
        errorRenderPage: 'Error al cargar la página',
        notPossibleLoadMetadataPage: 'No se pudieron cargar los metadatos de la página.'
    },
    pt: {
        errorRenderPage: 'Erro ao carregar a página',
        notPossibleLoadMetadataPage: 'Não foi possível carregar os metadados da página'
    },
    ru: {
        errorRenderPage: 'Ошибка загрузки страницы',
        notPossibleLoadMetadataPage: 'Не удалось загрузить метаданные страницы'
    }
};
let PoPageDynamicService = class PoPageDynamicService {
    constructor(http, notification, languageService) {
        this.http = http;
        this.notification = notification;
        this.endpoint = '/';
        this.headers = new HttpHeaders({
            'X-PO-SCREEN-LOCK': 'true'
        });
        this.language = languageService.getShortLanguage();
    }
    configServiceApi(config = {}) {
        this.endpoint = config.endpoint;
        this.metadata = config.metadata || this.metadata;
    }
    getMetadata(type = 'list') {
        const key = `${this.endpoint}-${type}-metadata`;
        const cache = JSON.parse(localStorage.getItem(key)) || {};
        const metadataUrlBase = this.metadata || `${this.endpoint}/metadata`;
        const url = `${metadataUrlBase}?type=${type}&version=${cache.version || ''}`;
        return this.http.get(url).pipe(map((response) => {
            if (response.version !== undefined && response.version === cache.version) {
                return cache;
            }
            localStorage.setItem(key, JSON.stringify(response));
            return Object.assign(Object.assign({}, cache), response);
        }), catchError((error) => {
            if (Object.keys(cache).length) {
                return of(cache);
            }
            const { errorRenderPage, notPossibleLoadMetadataPage } = poPageDynamicLiterals[this.language];
            this.notification.warning(notPossibleLoadMetadataPage);
            return merge(of({ title: errorRenderPage }), throwError(error));
        }));
    }
    // Deleta um único recurso
    deleteResource(id, endpoint) {
        return this.http.delete(`${this.getLocalEndPoint(endpoint, true)}/${id}`, { headers: this.headers });
    }
    // Deleta recursos em lote
    deleteResources(ids, endpoint) {
        return this.http.request('delete', `${this.getLocalEndPoint(endpoint)}`, { headers: this.headers, body: ids });
    }
    // Busca uma lista de recursos
    getResources(params, endpoint) {
        return this.http.get(this.getLocalEndPoint(endpoint), { headers: this.headers, params });
    }
    // Busca um único recurso
    getResource(id, endpoint) {
        return this.http.get(`${this.getLocalEndPoint(endpoint, true)}/${id}`, { headers: this.headers });
    }
    // Cria um recurso
    createResource(resource, endpoint) {
        return this.http.post(`${this.getLocalEndPoint(endpoint)}`, resource, { headers: this.headers });
    }
    // Atualiza um recurso
    updateResource(id, resource, endpoint) {
        return this.http.put(`${this.getLocalEndPoint(endpoint, true)}/${id}`, resource, { headers: this.headers });
    }
    getLocalEndPoint(endpoint, checkSingleBar = false) {
        endpoint = endpoint !== null && endpoint !== void 0 ? endpoint : this.endpoint;
        if (checkSingleBar) {
            endpoint = endpoint === '/' ? '' : endpoint;
        }
        return endpoint;
    }
};
PoPageDynamicService.ctorParameters = () => [
    { type: HttpClient },
    { type: PoNotificationService },
    { type: PoLanguageService }
];
PoPageDynamicService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PoPageDynamicService_Factory() { return new PoPageDynamicService(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.PoNotificationService), i0.ɵɵinject(i2.PoLanguageService)); }, token: PoPageDynamicService, providedIn: "root" });
PoPageDynamicService = __decorate([
    Injectable({
        providedIn: 'root'
    }),
    __metadata("design:paramtypes", [HttpClient,
        PoNotificationService,
        PoLanguageService])
], PoPageDynamicService);
export { PoPageDynamicService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG8tcGFnZS1keW5hbWljLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG8tdWkvbmctdGVtcGxhdGVzLyIsInNvdXJjZXMiOlsibGliL3NlcnZpY2VzL3BvLXBhZ2UtZHluYW1pYy9wby1wYWdlLWR5bmFtaWMuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxVQUFVLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUU5RixPQUFPLEVBQUUsS0FBSyxFQUFjLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDekQsT0FBTyxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUVqRCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUscUJBQXFCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7OztBQUloRixNQUFNLENBQUMsTUFBTSxxQkFBcUIsR0FBNkM7SUFDN0UsRUFBRSxFQUFFO1FBQ0YsZUFBZSxFQUFFLG9CQUFvQjtRQUNyQywyQkFBMkIsRUFBRSx1Q0FBdUM7S0FDckU7SUFDRCxFQUFFLEVBQUU7UUFDRixlQUFlLEVBQUUsMkJBQTJCO1FBQzVDLDJCQUEyQixFQUFFLG1EQUFtRDtLQUNqRjtJQUNELEVBQUUsRUFBRTtRQUNGLGVBQWUsRUFBRSwyQkFBMkI7UUFDNUMsMkJBQTJCLEVBQUUsa0RBQWtEO0tBQ2hGO0lBQ0QsRUFBRSxFQUFFO1FBQ0YsZUFBZSxFQUFFLDBCQUEwQjtRQUMzQywyQkFBMkIsRUFBRSwwQ0FBMEM7S0FDeEU7Q0FDRixDQUFDO0FBS0YsSUFBYSxvQkFBb0IsR0FBakMsTUFBYSxvQkFBb0I7SUFTL0IsWUFDVSxJQUFnQixFQUNoQixZQUFtQyxFQUMzQyxlQUFrQztRQUYxQixTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2hCLGlC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QUFSLFFBQVEsY0FBUixRQUFRLEdBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUNyQyxJQUFJLGNBQWMsRUFBRTtZQUNsQixRQUFRLEdBQUcsUUFBUSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUM7U0FDN0M7UUFDRCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0NBQ0YsQ0FBQTs7WUFoRmlCLFVBQVU7WUFDRixxQkFBcUI7WUFDMUIsaUJBQWlCOzs7QUFaekIsb0JBQW9CO0lBSGhDLFVBQVUsQ0FBQztRQUNWLFVBQVUsRUFBRSxNQUFNO0tBQ25CLENBQUM7cUNBV2dCLFVBQVU7UUFDRixxQkFBcUI7UUFDMUIsaUJBQWlCO0dBWnpCLG9CQUFvQixDQTBGaEM7U0ExRlksb0JBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSHR0cENsaWVudCwgSHR0cEVycm9yUmVzcG9uc2UsIEh0dHBIZWFkZXJzLCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5pbXBvcnQgeyBtZXJnZSwgT2JzZXJ2YWJsZSwgb2YsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgY2F0Y2hFcnJvciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuaW1wb3J0IHsgUG9MYW5ndWFnZVNlcnZpY2UsIFBvTm90aWZpY2F0aW9uU2VydmljZSB9IGZyb20gJ0Bwby11aS9uZy1jb21wb25lbnRzJztcblxuaW1wb3J0IHsgUG9QYWdlRHluYW1pY0xpdGVyYWxzIH0gZnJvbSAnLi9wby1wYWdlLWR5bmFtaWMtbGl0ZXJhbHMuaW50ZXJmYWNlJztcblxuZXhwb3J0IGNvbnN0IHBvUGFnZUR5bmFtaWNMaXRlcmFsczogeyBba2V5OiBzdHJpbmddOiBQb1BhZ2VEeW5hbWljTGl0ZXJhbHMgfSA9IHtcbiAgZW46IHtcbiAgICBlcnJvclJlbmRlclBhZ2U6ICdFcnJvciBsb2FkaW5nIHBhZ2UnLFxuICAgIG5vdFBvc3NpYmxlTG9hZE1ldGFkYXRhUGFnZTogJ1RoZSBwYWdlIG1ldGFkYXRhIGNvdWxkIG5vdCBiZSBsb2FkZWQnXG4gIH0sXG4gIGVzOiB7XG4gICAgZXJyb3JSZW5kZXJQYWdlOiAnRXJyb3IgYWwgY2FyZ2FyIGxhIHDDoWdpbmEnLFxuICAgIG5vdFBvc3NpYmxlTG9hZE1ldGFkYXRhUGFnZTogJ05vIHNlIHB1ZGllcm9uIGNhcmdhciBsb3MgbWV0YWRhdG9zIGRlIGxhIHDDoWdpbmEuJ1xuICB9LFxuICBwdDoge1xuICAgIGVycm9yUmVuZGVyUGFnZTogJ0Vycm8gYW8gY2FycmVnYXIgYSBww6FnaW5hJyxcbiAgICBub3RQb3NzaWJsZUxvYWRNZXRhZGF0YVBhZ2U6ICdOw6NvIGZvaSBwb3Nzw612ZWwgY2FycmVnYXIgb3MgbWV0YWRhZG9zIGRhIHDDoWdpbmEnXG4gIH0sXG4gIHJ1OiB7XG4gICAgZXJyb3JSZW5kZXJQYWdlOiAn0J7RiNC40LHQutCwINC30LDQs9GA0YPQt9C60Lgg0YHRgtGA0LDQvdC40YbRiycsXG4gICAgbm90UG9zc2libGVMb2FkTWV0YWRhdGFQYWdlOiAn0J3QtSDRg9C00LDQu9C+0YHRjCDQt9Cw0LPRgNGD0LfQuNGC0Ywg0LzQtdGC0LDQtNCw0L3QvdGL0LUg0YHRgtGA0LDQvdC40YbRiydcbiAgfVxufTtcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgUG9QYWdlRHluYW1pY1NlcnZpY2Uge1xuICBwcml2YXRlIGVuZHBvaW50ID0gJy8nO1xuICBwcml2YXRlIGxhbmd1YWdlOiBzdHJpbmc7XG4gIHByaXZhdGUgbWV0YWRhdGE6IHN0cmluZztcblxuICByZWFkb25seSBoZWFkZXJzOiBIdHRwSGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycyh7XG4gICAgJ1gtUE8tU0NSRUVOLUxPQ0snOiAndHJ1ZSdcbiAgfSk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LFxuICAgIHByaXZhdGUgbm90aWZpY2F0aW9uOiBQb05vdGlmaWNhdGlvblNlcnZpY2UsXG4gICAgbGFuZ3VhZ2VTZXJ2aWNlOiBQb0xhbmd1YWdlU2VydmljZVxuICApIHtcbiAgICB0aGlzLmxhbmd1YWdlID0gbGFuZ3VhZ2VTZXJ2aWNlLmdldFNob3J0TGFuZ3VhZ2UoKTtcbiAgfVxuXG4gIGNvbmZpZ1NlcnZpY2VBcGkoY29uZmlnOiB7IGVuZHBvaW50Pzogc3RyaW5nOyBtZXRhZGF0YT86IHN0cmluZyB9ID0ge30pIHtcbiAgICB0aGlzLmVuZHBvaW50ID0gY29uZmlnLmVuZHBvaW50O1xuICAgIHRoaXMubWV0YWRhdGEgPSBjb25maWcubWV0YWRhdGEgfHwgdGhpcy5tZXRhZGF0YTtcbiAgfVxuXG4gIGdldE1ldGFkYXRhPFQ+KHR5cGU6IHN0cmluZyA9ICdsaXN0Jyk6IE9ic2VydmFibGU8VD4ge1xuICAgIGNvbnN0IGtleSA9IGAke3RoaXMuZW5kcG9pbnR9LSR7dHlwZX0tbWV0YWRhdGFgO1xuICAgIGNvbnN0IGNhY2hlID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpKSB8fCB7fTtcbiAgICBjb25zdCBtZXRhZGF0YVVybEJhc2UgPSB0aGlzLm1ldGFkYXRhIHx8IGAke3RoaXMuZW5kcG9pbnR9L21ldGFkYXRhYDtcblxuICAgIGNvbnN0IHVybCA9IGAke21ldGFkYXRhVXJsQmFzZX0/dHlwZT0ke3R5cGV9JnZlcnNpb249JHtjYWNoZS52ZXJzaW9uIHx8ICcnfWA7XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxUPih1cmwpLnBpcGUoXG4gICAgICBtYXAoKHJlc3BvbnNlOiBhbnkpID0+IHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnZlcnNpb24gIT09IHVuZGVmaW5lZCAmJiByZXNwb25zZS52ZXJzaW9uID09PSBjYWNoZS52ZXJzaW9uKSB7XG4gICAgICAgICAgcmV0dXJuIGNhY2hlO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCBKU09OLnN0cmluZ2lmeShyZXNwb25zZSkpO1xuXG4gICAgICAgIHJldHVybiB7IC4uLmNhY2hlLCAuLi5yZXNwb25zZSB9O1xuICAgICAgfSksXG4gICAgICBjYXRjaEVycm9yKChlcnJvcjogSHR0cEVycm9yUmVzcG9uc2UpID0+IHtcbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNhY2hlKS5sZW5ndGgpIHtcbiAgICAgICAgICByZXR1cm4gb2YoY2FjaGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBlcnJvclJlbmRlclBhZ2UsIG5vdFBvc3NpYmxlTG9hZE1ldGFkYXRhUGFnZSB9ID0gcG9QYWdlRHluYW1pY0xpdGVyYWxzW3RoaXMubGFuZ3VhZ2VdO1xuXG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9uLndhcm5pbmcobm90UG9zc2libGVMb2FkTWV0YWRhdGFQYWdlKTtcblxuICAgICAgICByZXR1cm4gbWVyZ2Uob2YoeyB0aXRsZTogZXJyb3JSZW5kZXJQYWdlIH0pLCB0aHJvd0Vycm9yKGVycm9yKSk7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICAvLyBEZWxldGEgdW0gw7puaWNvIHJlY3Vyc29cbiAgZGVsZXRlUmVzb3VyY2UoaWQsIGVuZHBvaW50Pzogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmRlbGV0ZShgJHt0aGlzLmdldExvY2FsRW5kUG9pbnQoZW5kcG9pbnQsIHRydWUpfS8ke2lkfWAsIHsgaGVhZGVyczogdGhpcy5oZWFkZXJzIH0pO1xuICB9XG5cbiAgLy8gRGVsZXRhIHJlY3Vyc29zIGVtIGxvdGVcbiAgZGVsZXRlUmVzb3VyY2VzKGlkczogQXJyYXk8YW55PiwgZW5kcG9pbnQ/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAucmVxdWVzdCgnZGVsZXRlJywgYCR7dGhpcy5nZXRMb2NhbEVuZFBvaW50KGVuZHBvaW50KX1gLCB7IGhlYWRlcnM6IHRoaXMuaGVhZGVycywgYm9keTogaWRzIH0pO1xuICB9XG5cbiAgLy8gQnVzY2EgdW1hIGxpc3RhIGRlIHJlY3Vyc29zXG4gIGdldFJlc291cmNlcyhwYXJhbXM/OiBIdHRwUGFyYW1zLCBlbmRwb2ludD86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodGhpcy5nZXRMb2NhbEVuZFBvaW50KGVuZHBvaW50KSwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMsIHBhcmFtcyB9KTtcbiAgfVxuXG4gIC8vIEJ1c2NhIHVtIMO6bmljbyByZWN1cnNvXG4gIGdldFJlc291cmNlKGlkLCBlbmRwb2ludD86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQoYCR7dGhpcy5nZXRMb2NhbEVuZFBvaW50KGVuZHBvaW50LCB0cnVlKX0vJHtpZH1gLCB7IGhlYWRlcnM6IHRoaXMuaGVhZGVycyB9KTtcbiAgfVxuXG4gIC8vIENyaWEgdW0gcmVjdXJzb1xuICBjcmVhdGVSZXNvdXJjZShyZXNvdXJjZSwgZW5kcG9pbnQ/OiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChgJHt0aGlzLmdldExvY2FsRW5kUG9pbnQoZW5kcG9pbnQpfWAsIHJlc291cmNlLCB7IGhlYWRlcnM6IHRoaXMuaGVhZGVycyB9KTtcbiAgfVxuXG4gIC8vIEF0dWFsaXphIHVtIHJlY3Vyc29cbiAgdXBkYXRlUmVzb3VyY2UoaWQsIHJlc291cmNlLCBlbmRwb2ludD86IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQoYCR7dGhpcy5nZXRMb2NhbEVuZFBvaW50KGVuZHBvaW50LCB0cnVlKX0vJHtpZH1gLCByZXNvdXJjZSwgeyBoZWFkZXJzOiB0aGlzLmhlYWRlcnMgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldExvY2FsRW5kUG9pbnQoZW5kcG9pbnQ/OiBzdHJpbmcsIGNoZWNrU2luZ2xlQmFyID0gZmFsc2UpIHtcbiAgICBlbmRwb2ludCA9IGVuZHBvaW50ID8/IHRoaXMuZW5kcG9pbnQ7XG4gICAgaWYgKGNoZWNrU2luZ2xlQmFyKSB7XG4gICAgICBlbmRwb2ludCA9IGVuZHBvaW50ID09PSAnLycgPyAnJyA6IGVuZHBvaW50O1xuICAgIH1cbiAgICByZXR1cm4gZW5kcG9pbnQ7XG4gIH1cbn1cbiJdfQ==